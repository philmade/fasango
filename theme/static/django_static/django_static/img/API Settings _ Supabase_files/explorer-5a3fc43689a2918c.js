(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6526],{33244:function(e,t,r){"use strict";var n=r(94269),s=r(47314),i=r(99099),a=r(79894),o=r.n(a),c=r(86677),l=r(27102),u=r(20796),p=r(24246);t.Z=function(e){var t,r=e.show,a=e.setShowUpgradePrompt,d=e.subscription,f=(0,c.useRouter)().query.ref,m=(null===d||void 0===d||null===(t=d.tier)||void 0===t?void 0:t.supabase_prod_id)===u.ev.TEAM,h=(0,l.P5)("teamTier")||m;return(0,p.jsx)(n.C,{hideFooter:!0,visible:r,closable:!0,size:"medium",header:"Log retention",onCancel:function(){return a(!1)},children:(0,p.jsxs)("div",{className:"space-y-4 py-4",children:[(0,p.jsx)(n.C.Content,{children:(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,p.jsxs)("div",{className:"border-scale-600 bg-scale-500 rounded border",children:[(0,p.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,p.jsx)("p",{className:"text-scale-1100 w-[40%] text-sm",children:"Plan"}),(0,p.jsx)("p",{className:"text-scale-1100 w-[60%] text-sm",children:"Retention duration"})]}),(0,p.jsxs)("div",{className:"py-1",children:[(0,p.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,p.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,p.jsx)("p",{className:"w-[60%] text-sm",children:i.fg.FREE.text})]}),(0,p.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,p.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,p.jsx)("p",{className:"w-[60%] text-sm",children:i.fg.PRO.text})]}),h&&(0,p.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,p.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,p.jsx)("p",{className:"w-[60%] text-sm",children:i.fg.TEAM.text})]}),(0,p.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,p.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,p.jsx)("p",{className:"w-[60%] text-sm",children:i.fg.ENTERPRISE.text})]})]})]})]})}),(0,p.jsx)(n.C.Separator,{}),(0,p.jsx)(n.C.Content,{children:(0,p.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,p.jsx)(s.z,{type:"default",onClick:function(){return a(!1)},children:"Close"}),(0,p.jsx)(o(),{href:"/project/".concat(f,"/settings/billing/subscription"),passHref:!0,children:(0,p.jsx)("a",{children:(0,p.jsx)(s.z,{size:"tiny",children:"Upgrade"})})})]})})]})})}},73998:function(e,t,r){"use strict";r(27378);var n=r(24246);t.Z=function(e){var t=e.children,r=e.active,s=e.className;return(0,n.jsx)("div",{className:[s,"flex h-full flex-grow transition-opacity ",r?"opacity-30":"opacity-100"].join(" "),children:t})}},92782:function(e,t,r){"use strict";r.d(t,{U:function(){return n}});var n={subscription:function(e){return["projects",e,"subscription"]},subscriptionV2:function(e){return["projects",e,"subscriptionV2"]},addons:function(e){return["projects",e,"addons"]},plans:function(e){return["projects",e,"plans"]},preview:function(e){return["projects",e,"subscription-preview"]}}},82672:function(e,t,r){"use strict";r.d(t,{S2:function(){return j}});var n=r(90849),s=r(90089),i=r(55732),a=r(34707),o=r.n(a),c=r(36492),l=r(14919),u=r(20796),p=(r(27378),r(92782)),d=["enabled"];function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){return x.apply(this,arguments)}function x(){return(x=(0,i.Z)(o().mark((function e(t,r){var n,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.projectRef){e.next=3;break}throw new Error("projectRef is required");case 3:return e.next=5,(0,l.U2)("".concat(u.T5,"/projects/").concat(n,"/subscription"),{signal:r});case 5:if(!(s=e.sent).error){e.next=8;break}throw s.error;case 8:return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=function(e){var t=e.projectRef,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.enabled,i=void 0===n||n,a=(0,s.Z)(r,d);return(0,c.a)(p.U.subscription(t),(function(e){var r=e.signal;return h({projectRef:t},r)}),m({enabled:i&&"undefined"!==typeof t},a))}},35835:function(e,t,r){"use strict";var n=r(90849),s=r(36492),i=r(99099),a=r(27378),o=r(20796),c=r(14919);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}t.Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,i.PJ)(i.up),n=(0,a.useState)({sql:(null===t||void 0===t?void 0:t.sql)||"",project:e,iso_timestamp_start:t.iso_timestamp_start?t.iso_timestamp_start:r.calcFrom(),iso_timestamp_end:t.iso_timestamp_end?t.iso_timestamp_end:r.calcTo()}),l=n[0],p=n[1],d="undefined"!==typeof e&&Boolean(l.sql),f=(0,i.GT)(l),m=(0,s.a)(["projects",e,"logs",f],(function(t){var r=t.signal;return(0,c.U2)("".concat(o.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(f),{signal:r})}),{enabled:d,refetchOnWindowFocus:!1}),h=m.data,x=m.error,j=m.isLoading,v=m.isRefetching,g=m.refetch,y=x?x.message:null;!y&&null!==h&&void 0!==h&&h.error&&(y=null===h||void 0===h?void 0:h.error);var b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";p((function(t){return u(u({},t),{},{sql:e})}))};return{params:l,isLoading:d&&j||v,logData:null!==h&&void 0!==h&&h.result?null===h||void 0===h?void 0:h.result:[],error:y,changeQuery:b,runQuery:function(){return g()},setParams:p}}},968:function(e,t,r){"use strict";r.d(t,{_:function(){return o}});var n=r(27378),s=r(36802),i=r(99099),a=r(82672),o=function(e){var t=(0,s.UO)().ref,r=(0,a.S2)({projectRef:t}).data,o=null===r||void 0===r?void 0:r.tier,c=(0,n.useState)(!1),l=c[0],u=c[1],p=(0,i.dP)(e,null===o||void 0===o?void 0:o.key);return(0,n.useEffect)((function(){p&&u(!0)}),[e]),{showUpgradePrompt:l,setShowUpgradePrompt:u,shouldShowUpgradePrompt:p}}},60942:function(e,t,r){"use strict";r.r(t),r.d(t,{LogsExplorerPage:function(){return R}});var n=r(55732),s=r(90849),i=r(34707),a=r.n(i),o=r(27693),c=r.n(o),l=r(27378),u=r(86677),p=r(43659),d=r(94269),f=r(77758),m=r(3648),h=r(47314),x=r(27102),j=r(36802),v=r(35835),g=r(82672),y=r(24903),b=r(42753),w=r(69060),O=r(71714),_=r(73998),P=r(99099),N=r(968),S=r(33244),q=r(93687),E=r(24246);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var R=function(){(0,P.Q9)();var e=(0,x.oR)(),t=e.ui,r=e.content,s=(0,u.useRouter)(),i=(0,j.UO)(),o=i.ref,p=i.q,b=i.ite,k=i.its,R=(0,l.useState)((0,y.k$)()),Z=R[0],D=R[1],T=(0,l.useState)("select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5"),U=T[0],L=T[1],z=(0,l.useState)(!1),F=z[0],I=z[1],Q=(0,l.useState)([]),V=Q[0],$=Q[1],M=(0,g.S2)({projectRef:o}).data,A=null===M||void 0===M?void 0:M.tier,B=(0,v.Z)(o,{iso_timestamp_start:k||void 0,iso_timestamp_end:b||void 0}),W=B.params,X=B.logData,G=B.error,H=B.isLoading,J=B.changeQuery,K=B.runQuery,Y=B.setParams,ee=(0,N._)(W.iso_timestamp_start),te=ee.showUpgradePrompt,re=ee.setShowUpgradePrompt;(0,l.useEffect)((function(){p&&ne({mode:"custom",searchString:p})}),[]),(0,l.useEffect)((function(){var e=[],t=W.iso_timestamp_start?c()(W.iso_timestamp_start):c()(),r=W.iso_timestamp_end?c()(W.iso_timestamp_end):c()(),n=Math.abs(t.diff(r,"days"));U&&!U.includes("limit")&&n>P.$K&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),$(e)}),[U,W.iso_timestamp_start,W.iso_timestamp_end]),(0,l.useEffect)((function(){k&&((0,P.dP)(k,null===A||void 0===A?void 0:A.key)&&re(!te))}),[k,A]);var ne=function(e){L(e.searchString),J(e.searchString),D((0,y.k$)()),s.push({pathname:s.pathname,query:C(C({},s.query),{},{q:e.searchString})}),r.addRecentLogSqlSnippet({sql:e.searchString})},se=function(e){var t="string"===typeof e&&e||U;e&&"string"===typeof e&&L(e),J(t),K(),s.push({pathname:s.pathname,query:C(C({},s.query),{},{q:t})}),r.addRecentLogSqlSnippet({sql:t})};return(0,E.jsxs)("div",{className:"w-full h-full px-5 py-6 mx-auto",children:[(0,E.jsx)(q.Z,{}),(0,E.jsxs)("div",{className:"flex flex-col flex-grow h-full gap-4",children:[(0,E.jsxs)("div",{className:"border rounded",children:[(0,E.jsx)(P.dL,{defaultFrom:W.iso_timestamp_start||"",defaultTo:W.iso_timestamp_end||"",onDateChange:function(e){var t=e.to,r=e.from;(0,P.dP)(r,null===A||void 0===A?void 0:A.key)?re(!te):(Y((function(e){return C(C({},e),{},{iso_timestamp_start:r||"",iso_timestamp_end:t||""})})),s.push({pathname:s.pathname,query:C(C({},s.query),{},{its:r||"",ite:t||""})}))},onSelectSource:function(e){L((function(t){return t+e})),D((0,y.k$)())},onClear:function(){L(""),D((0,y.k$)()),J("")},onRun:se,hasEditorValue:Boolean(U),templates:P.xN.filter((function(e){return"custom"===e.mode})),onSelectTemplate:ne,onSave:function(){I(!F)},isLoading:H,warnings:V}),(0,E.jsxs)("div",{className:"h-48 min-h-[7rem]",children:[(0,E.jsx)(O.Z,{active:H}),(0,E.jsx)(w.ZP,{id:Z,language:"pgsql",defaultValue:U,onInputChange:function(e){return L(e||"")},onInputRun:se})]})]}),(0,E.jsxs)("div",{className:"relative flex flex-col flex-grow",children:[(0,E.jsx)(_.Z,{active:H,children:(0,E.jsx)("div",{className:"flex flex-grow h-full",children:(0,E.jsx)(P.ol,{params:W,data:X,error:G,projectRef:o})})}),(0,E.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,E.jsx)(S.Z,{show:te,setShowUpgradePrompt:re,subscription:M})})]})]}),(0,E.jsx)(d.C,{size:"medium",onCancel:function(){return I(!F)},header:"Save log query",visible:F,hideFooter:!0,children:(0,E.jsx)(f.Z,{initialValues:{name:"",desdcription:""},onSubmit:function(){var e=(0,n.Z)(a().mark((function e(n,s){var i,o,c,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=s.setSubmitting)(!0),o={name:n.name,description:n.description||"",type:"log_sql",content:{content_id:Z,sql:U,schema_version:"1",favorite:!1},visibility:"user"},e.prev=3,e.next=6,r.create(o);case 6:if(c=e.sent,c.data,!(l=c.error)){e.next=11;break}throw l;case 11:i(!1),I(!1),t.setNotification({category:"success",message:'Saved "'.concat(n.name,'" log query')}),e.next=22;break;case 16:e.prev=16,e.t0=e.catch(3),console.error(e.t0),i(!1),I(!1),t.setNotification({error:e.t0,category:"error",message:"Failed to save query: ".concat(e.t0.message)});case 22:case"end":return e.stop()}}),e,null,[[3,16]])})));return function(t,r){return e.apply(this,arguments)}}(),children:function(e){var t=e.isSubmitting;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{className:"py-4",children:(0,E.jsx)(d.C.Content,{children:(0,E.jsxs)("div",{className:"space-y-6",children:[(0,E.jsx)(m.Z,{layout:"horizontal",label:"Name",id:"name"}),(0,E.jsx)("div",{className:"text-area-text-sm",children:(0,E.jsx)(m.Z.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]})})}),(0,E.jsx)("div",{className:"py-3 border-t bg-scale-300",children:(0,E.jsx)(d.C.Content,{children:(0,E.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,E.jsx)(h.z,{size:"tiny",type:"default",onClick:function(){return I(!F)},children:"Cancel"}),(0,E.jsx)(h.z,{size:"tiny",loading:t,htmlType:"submit",children:"Save"})]})})})]})}})})]})};R.getLayout=function(e){return(0,E.jsx)(b.Uj,{children:e})},t.default=(0,p.Pi)(R)},21098:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return r(60942)}])}},function(e){e.O(0,[7930,1188,2056,5286,3687,9774,2888,179],(function(){return t=21098,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=explorer-5a3fc43689a2918c.js.map