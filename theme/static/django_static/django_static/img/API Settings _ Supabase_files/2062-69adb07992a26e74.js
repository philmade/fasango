"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2062],{32062:function(e,n,t){t.d(n,{ub:function(){return er},l5:function(){return Zt},ZP:function(){return nr}});var r=t(90849),a=t(55732),i=t(11246),s=t(34707),o=t.n(s),l=t(27378),c=t(43659),d=t(86677),u=t(98784),m=t(68043),f=t(85945),p=t(27102),h=t(98248),v=t(36802),x=t(79894),j=t.n(x),b=t(47314),y=t(4708),g=t(86223),N=t(33769),w=t(98213),O=t(24246),S=function(e){var n,t=e.table,r=e.apiPreviewPanelOpen,a=e.setApiPreviewPanelOpen,i=e.refreshDocs,s=(0,p.oR)(),o=s.ui,l=s.meta,c=null===(n=o.selectedProject)||void 0===n?void 0:n.ref,d=l.policies.list((function(e){return e.table_id===t.id})),u=!(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"columns");function f(){a(!r),i()}var h=function(){return(0,O.jsx)(b.z,{size:"tiny",type:"default",icon:(0,O.jsx)(y.Z,{size:14,strokeWidth:2}),onClick:f,children:"API"})};return(0,O.jsxs)("div",{className:"flex items-center space-x-3",children:[u&&(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{className:"w-full",children:(0,O.jsx)("div",{className:"border border-scale-700 rounded bg-scale-500 px-3 py-1 text-xs",children:"Viewing as read-only"})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200"].join(" "),children:(0,O.jsx)("span",{className:"text-xs text-scale-1200",children:"You need additional permissions to manage your project's data"})})]})})]}),(0,O.jsx)(j(),{href:"/project/".concat(c,"/auth/policies?search=").concat(t.id),children:(0,O.jsx)("a",{children:(0,O.jsx)(b.z,{type:t.rls_enabled?"link":"warning",icon:t.rls_enabled?(0,O.jsx)(g.Z,{strokeWidth:2,size:14}):(0,O.jsx)(N.Z,{strokeWidth:2,size:14}),children:t.rls_enabled?"".concat(0==d.length?"No":d.length," active RLS polic").concat(d.length>1||0==d.length?"ies":"y"):"RLS is not enabled"})})}),(0,O.jsx)("div",{className:"mt-[1px]",children:(0,O.jsx)(h,{})})]})},k=t(33114),P=function(e){var n=e.id;return(0,O.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,O.jsx)("div",{className:"w-[400px]",children:(0,O.jsx)(k.Z,{icon:(0,O.jsx)(N.Z,{strokeWidth:2}),title:"Unable to find your table with ID ".concat(n)})})})},C=t(90089),Z=t(94269),E=t(30630),_=t(48228),R=t(67291),D=t(51991),T=t(41532),A=["onSuccess"];function L(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?L(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function I(e){var n,t=e.table,r=e.payload,a=e.enumArrayColumns;return(new R.Query).from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).insert([r],{returning:!0,enumArrayColumns:a}).toSql()}function K(e){return F.apply(this,arguments)}function F(){return(F=(0,a.Z)(o().mark((function e(n){var t,r,a,i,s,l,c,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,r=n.connectionString,a=n.table,i=n.payload,s=n.enumArrayColumns,l=I({table:a,payload:i,enumArrayColumns:s}),e.next=4,(0,D.Rj)({projectRef:t,connectionString:r,sql:l});case 4:return c=e.sent,d=c.result,e.abrupt("return",d);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=["onSuccess"];function V(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?V(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function W(e){var n,t=e.table,r=e.configuration,a=e.payload,i=e.enumArrayColumns;return(new R.Query).from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).update(a,{returning:!0,enumArrayColumns:i}).match(r.identifiers).toSql()}function M(e){return Y.apply(this,arguments)}function Y(){return(Y=(0,a.Z)(o().mark((function e(n){var t,r,a,i,s,l,c,d,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.projectRef,r=n.connectionString,a=n.table,i=n.payload,s=n.configuration,l=n.enumArrayColumns,c=W({table:a,configuration:s,payload:i,enumArrayColumns:l}),e.next=4,(0,D.Rj)({projectRef:t,connectionString:r,sql:c});case 4:return d=e.sent,u=d.result,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=(0,C.Z)(e,U),r=(0,f.NL)();return(0,_.D)((function(e){return M(e)}),H({onSuccess:function(e,t,i){return(0,a.Z)(o().mark((function a(){var s,l;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.projectRef,l=t.table,a.next=3,r.invalidateQueries(T.M.query(s,[l.schema,l.name]));case 3:return a.next=5,null===n||void 0===n?void 0:n(e,t,i);case 5:case"end":return a.stop()}}),a)})))()}},t))},B=t(47510),Q=t(63840),J=t(70417),G=t(90085),X=t(22917),$=function(e){var n=e.queryId,t=void 0===n?"":n,r=e.defaultValue,a=void 0===r?"":r,i=e.readOnly,s=void 0!==i&&i,o=e.onInputChange,c=void 0===o?function(){}:o,d=(0,G.Ik)(),u=(0,l.useRef)(),m=(0,X.Fg)().isDarkMode;(0,l.useEffect)((function(){d&&d.editor.defineTheme("supabase",{base:"vs-dark",inherit:!0,rules:[{background:m?"1f1f1f":"30313f"},{token:"string.sql",foreground:"24b47e"},{token:"comment",foreground:"666666"},{token:"predefined.sql",foreground:"D4D4D4"}],colors:{"editor.background":m?"#1f1f1f":"#30313f"}})}),[m,d]);var f=function(){return(0,O.jsx)("h4",{children:"Loading"})};return(0,O.jsx)(G.ZP,{className:"monaco-editor",theme:"vs-dark",defaultLanguage:"json",defaultValue:a,path:t,loading:(0,O.jsx)(f,{}),options:{readOnly:s,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0},onMount:function(e,n){u.current=e,e.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}))},onChange:c})},ee=t(86010),ne=function(e){var n=e.options,t=e.width,r=void 0===t?50:t,a=e.activeOption,i=e.onClickOption,s=e.borderOverride,o=void 0===s?"border-gray-600 dark:border-gray-800":s;return(0,O.jsxs)("div",{className:"relative border ".concat(o," rounded-md h-7"),style:{padding:1,width:2*(r+1)},children:[(0,O.jsx)("span",{style:{width:r,translate:a===n[1]?"0px":"".concat(r-2,"px")},"aria-hidden":"true",className:(0,ee.Z)("z-0 inline-block rounded h-full bg-scale-200 dark:bg-scale-600 shadow transform","transition-all ease-in-out border border-scale-700")}),n.map((function(e,n){return(0,O.jsx)("span",{style:{width:r+1},className:"\n              ".concat(a===e?"text-scale-1200":"text-scale-1000","\n              ").concat(0===n?"right-0":"left-0","\n              ").concat((t=a===e,"absolute top-0 z-1 text-xs inline-flex h-full items-center justify-center font-medium\n    ".concat(t?"hover:text-scale-1100 dark:hover:text-white":"hover:text-gray-600"," dark:hover:text-white focus:z-10 focus:outline-none focus:border-blue-300 focus:ring-blue\n    transition ease-in-out duration-150")),"\n              cursor-pointer\n            "),onClick:function(){return i(e)},children:(0,O.jsx)("span",{className:(0,ee.Z)("capitalize hover:text-scale-1200 dark:hover:text-scale-1200",a===e?"text-scale-1200":"text-scale-1000"),children:e})},"toggle_".concat(n));var t}))]})},te=t(47939),re=function(e){var n=e.pane,t=e.jsonData,r=e.activeKey,a=e.onSelectKey,i=void 0===a?function(){}:a;if(!t)return(0,O.jsx)("div",{className:"flex-1 ".concat(2===n?"border-l border-gray-500":""),children:(0,O.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,O.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(t).length)return(0,O.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-gray-500":""),children:(0,O.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,O.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});var s=Object.keys(t).filter((function(e){return"object"===typeof t[e]&&!(0,u.isNull)(t[e])})),o=Object.keys(t).filter((function(e){return(0,u.isNull)(t[e])||"object"!==typeof t[e]}));return(0,O.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-gray-500":""),children:[s.map((function(e){return(0,O.jsxs)("div",{className:"\n              ".concat(e===r?"bg-gray-100 dark:bg-gray-400":"","\n              group flex cursor-pointer items-center\n              justify-between py-2 px-5 hover:bg-gray-100 dark:hover:bg-gray-500\n            "),onClick:function(){return i(e,n)},children:[(0,O.jsx)("p",{className:"font-mono text-xs !text-blue-700 dark:!text-blue-1100",children:e}),(0,O.jsx)("div",{className:"".concat(e===r?"block":"hidden"," group-hover:block"),children:(0,O.jsx)(te.Z,{strokeWidth:2,size:16})})]},e)})),o.map((function(e){return(0,O.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,O.jsxs)("p",{className:"font-mono text-xs !text-blue-700 dark:!text-blue-1100",children:[e,":"]}),(0,O.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!==typeof t[e]?"!text-green-700 dark:!text-green-1000":"!text-yellow-700 dark:!text-yellow-900"),children:(0,u.isNull)(t[e])?"null":"string"===typeof t[e]?'"'.concat(t[e],'"'):t[e].toString()})]},e)}))]})},ae=t(72112),ie=function(e){var n=e.breadcrumbs,t=void 0===n?[]:n,r=e.onSelectBreadcrumb,a=void 0===r?function(){}:r;return(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(ae.Z,{size:16,strokeWidth:2}),t.length>0&&t.map((function(e){return(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(te.Z,{size:16,strokeWidth:2}),e===(0,u.last)(t)?(0,O.jsx)("p",{className:"font-mono text-xs",children:e}):(0,O.jsx)("p",{className:"font-mono text-xs",children:(0,O.jsx)("div",{className:"cursor-pointer",onClick:function(){return a(t.slice(0,t.indexOf(e)+1))},children:e})})]},e)}))]})};function se(e,n){var t="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(!e)return;if("string"===typeof e)return oe(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oe(e,n)}(e))||n&&e&&"number"===typeof e.length){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==t.return||t.return()}finally{if(o)throw i}}}}function oe(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function le(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}var ce=function(e){var n=e.jsonData,t=void 0===n?{}:n,a=(0,l.useState)(),i=a[0],s=a[1],o=(0,l.useState)([]),c=o[0],d=o[1],m=(0,l.useState)(t),f=m[0],p=m[1],h=(0,l.useState)({}),v=h[0],x=h[1],j=function(e,n){s(e);var t=c.slice();1===n&&(x(f[e]),(0,u.isEmpty)(v)?(t.push(e),d(t)):(t.pop(),t.push(e),d(t))),2===n&&(p(v),x(v[e]),t.push(e),d(t))};return(0,O.jsxs)("div",{className:"border border-gray-500 rounded",children:[(0,O.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,O.jsx)(ie,{breadcrumbs:c,onSelectBreadcrumb:function(e){var n=(0,u.last)(e)||"";s(n);var a=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?le(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):le(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},t),i=c.slice(0,c.indexOf(n)+1);if(d(i),null===e)p(a),x({});else if(1===e.length)p(a),x(t[c[0]]);else{var o,l=se(e);try{for(l.s();!(o=l.n()).done;){var m=o.value;a=a[m],e.indexOf(m)===e.length-2&&p(a)}}catch(f){l.e(f)}finally{l.f()}x(a)}}})}),(0,O.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-gray-500",children:[(0,O.jsx)(re,{pane:1,jsonData:f,onSelectKey:j,activeKey:i}),(0,O.jsx)(re,{pane:2,jsonData:v,onSelectKey:j})]})]})},de=ce,ue=t(3305),me=t(24903),fe=function(e){var n=e.column,t=e.jsonString,r=e.visible,i=e.backButtonLabel,s=e.applyButtonLabel,c=e.closePanel,d=e.onSaveJSON,u=(0,p.oR)().ui,m=(0,l.useState)("edit"),f=m[0],h=m[1],v=(0,l.useState)(""),x=v[0],j=v[1];(0,l.useEffect)((function(){if(r){var e=(0,me.ZO)(t);j(e)}}),[r]);var b=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=(0,me.jn)(x),d&&d(t)}catch(a){r=a.message?"Error: ".concat(a.message):"JSON seems to have an invalid structure.",u.setNotification({category:"error",message:r,duration:4e3})}finally{n()}case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,O.jsx)(J.ZP,{size:"large",header:(0,O.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===f?(0,O.jsxs)("p",{children:["Editing JSON Field: ",(0,O.jsx)("code",{children:n})]}):(0,O.jsxs)("p",{children:["Viewing JSON Field: ",(0,O.jsx)("code",{children:n})]}),(0,O.jsx)(ne,{options:["view","edit"],activeOption:f,borderOverride:"border-gray-500",onClickOption:function(e){h(e)}})]}),visible:r,onCancel:c,customFooter:(0,O.jsx)(ue.Z,{closePanel:c,backButtonLabel:i,applyButtonLabel:s,applyFunction:b}),children:(0,O.jsx)("div",{className:"py-4",children:(0,O.jsx)(J.ZP.Content,{children:(0,O.jsx)("div",{className:"mt-4 flex flex-auto flex-col space-y-4",children:"edit"===f?(0,O.jsx)("div",{className:"h-[500px] w-full flex-grow border dark:border-dark",children:(0,O.jsx)($,{onInputChange:function(e){j(null!==e&&void 0!==e?e:"")},defaultValue:x.toString()})}):(0,O.jsx)(de,{jsonData:(0,me.dW)(x)})})})})})},pe=t(93716),he=t(31536),ve=t(12803),xe=t(28053),je=t(17440),be=t(97033),ye=t(29026),ge=t(14971);var Ne=t(98637),we=t(85742),Oe=t(77141),Se=t(70191),ke=function(e){var n=e.table,t=e.rows,r=e.onRowSelect,a=n.columns.map((function(e){var n=(0,Oe.ve)(e),t=(e.name.length+e.format.length)*Oe.i1,r=n<t?t:n;return{key:e.name,name:e.name,formatter:function(n){var t=n.row;return function(e,n){var t="object"===typeof n[e]?JSON.stringify(n[e]):n[e];return(0,O.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden",children:(0,O.jsx)("span",{className:"text-sm truncate",children:t})})}(e.name,t)},headerRenderer:function(){return function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,O.jsxs)("div",{className:"flex h-full items-center justify-center gap-2",children:[n&&(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{children:(0,O.jsx)("div",{className:"text-brand-900",children:(0,O.jsx)(we.Z,{size:"tiny",strokeWidth:2})})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,O.jsx)("span",{className:"text-xs text-scale-1200",children:"Primary key"})})]})})]}),(0,O.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})}(e.name,e.isPrimaryKey)},resizable:!0,width:r,minWidth:Se.mr}}));return(0,O.jsx)(Ne.ZP,{columns:a,rows:t,style:{height:"100%"},onRowClick:r,rowClass:function(){return"cursor-pointer"}})},Pe=t(39919),Ce=t(21063),Ze=function(e){var n=e.page,t=e.setPage,r=e.rowsPerPage,a=e.currentPageRowsCount,i=void 0===a?0:a,s=e.isLoading,o=void 0!==s&&s,l=i<r;return(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[o&&(0,O.jsx)(ge.Z,{size:14,className:"animate-spin"}),(0,O.jsx)(b.z,{icon:(0,O.jsx)(Pe.Z,{}),type:"outline",disabled:n<=1||o,onClick:function(){t((function(e){return e-1}))},title:"Previous Page",style:{padding:"3px 10px"}}),(0,O.jsx)(b.z,{icon:(0,O.jsx)(Ce.Z,{}),type:"outline",disabled:l||o,onClick:function(){t((function(e){return e+1}))},title:"Next Page",style:{padding:"3px 10px"}})]})},Ee=function(e){var n,t,r,i,s,c,d=e.visible,u=e.foreignKey,m=e.onSelect,f=e.closePanel,h=(0,p.oR)().meta,v=(0,B.d2)().project,x=null!==u&&void 0!==u?u:{},j=x.target_id,b=x.target_schema,y=x.target_table,g=x.target_columns,N=j?h.tables.byId(j):void 0;(0,l.useEffect)((function(){!N&&j&&h.tables.loadById(j)}),[N,j]);var w=function(e){var n=e.schemaName,t=e.tableName,r=(0,p.P5)("vaultExtension"),i=(0,p.oR)().vault,s=(0,l.useState)([]),c=s[0],d=s[1];return(0,l.useEffect)((function(){var e=!0,s=function(){var s=(0,a.Z)(o().mark((function a(){var s;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0===n||void 0===t||!r){a.next=5;break}return a.next=3,i.listEncryptedColumns(n,t);case 3:s=a.sent,e&&d(s);case 5:case"end":return a.stop()}}),a)})));return function(){return s.apply(this,arguments)}}();return s(),function(){e=!1}}),[n,t,r]),c}({schemaName:b,tableName:y}),S=N&&(0,R.parseSupaTable)({table:N,columns:null!==(n=N.columns)&&void 0!==n?n:[],primaryKeys:N.primary_keys,relationships:N.relationships},w),k=(0,l.useState)({filter:[],sort:[]}),P=k[0],C=k[1],Z=(0,be.rg)(null!==(t=P.sort)&&void 0!==t?t:[]),E=(0,be.Yb)(null!==(r=P.filter)&&void 0!==r?r:[]),_=(0,l.useState)(1),D=_[0],T=_[1],A=(0,ye.KK)({queryKey:[b,y],projectRef:null===v||void 0===v?void 0:v.ref,connectionString:null===v||void 0===v?void 0:v.connectionString,table:S,sorts:Z,filters:E,page:D,limit:100},{keepPreviousData:!0}),L=A.data,z=A.isLoading,I=A.isSuccess,K=A.isError,F=A.isRefetching;return(0,O.jsx)(J.ZP,{visible:d,size:"large",header:(0,O.jsxs)("div",{children:["Select a record to reference from"," ",(0,O.jsxs)("code",{className:"font-mono text-sm",children:[b,".",y]})]}),onCancel:f,customFooter:(0,O.jsx)(ue.Z,{hideApply:!0,backButtonLabel:"Cancel",closePanel:f}),children:(0,O.jsx)(J.ZP.Content,{className:"h-full !px-0",children:(0,O.jsxs)("div",{className:"h-full",children:[z&&(0,O.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,O.jsx)(ge.Z,{className:"animate-spin"}),(0,O.jsx)("p",{className:"text-sm text-scale-1100",children:"Loading rows"})]}),K&&(0,O.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,O.jsxs)("p",{className:"text-sm text-scale-1100",children:["Unable to load rows from"," ",(0,O.jsxs)("code",{children:[b,".",y]}),". Please try again or contact support."]})}),I&&S&&(0,O.jsxs)("div",{className:"h-full flex flex-col",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,O.jsxs)("div",{className:"flex items-center",children:[(0,O.jsx)(ve.Z,{table:S,isRefetching:F}),(0,O.jsx)(xe.Z,{table:S,filters:null!==(i=P.filter)&&void 0!==i?i:[],setParams:function(){D>1&&T(1),C.apply(void 0,arguments)}}),(0,O.jsx)(pe.W,{backend:he.PD,children:(0,O.jsx)(je.Z,{table:S,sorts:null!==(s=P.sort)&&void 0!==s?s:[],setParams:C})})]}),(0,O.jsx)(Ze,{page:D,setPage:T,rowsPerPage:100,currentPageRowsCount:null!==(c=null===L||void 0===L?void 0:L.rows.length)&&void 0!==c?c:0,isLoading:F})]}),L.rows.length>0?(0,O.jsx)(ke,{table:S,rows:L.rows,onRowSelect:function(e){return m(e[null!==g&&void 0!==g?g:""])}}):(0,O.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-scale-500",children:(0,O.jsx)("span",{className:"text-scale-1100 text-sm",children:"No Rows Found"})})]})]})})})},_e=["columnId"];function Re(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function De(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Re(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Re(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Te=function(e){var n,t,s,c,d,m=e.selectedSchema,h=e.selectedTable,v=e.selectedRowToEdit,x=e.selectedColumnToEdit,j=e.selectedTableToEdit,b=e.selectedValueForJsonEdit,y=e.selectedForeignKeyToEdit,g=e.sidePanelKey,N=e.isDuplicating,w=void 0!==N&&N,S=e.closePanel,k=e.onRowCreated,P=void 0===k?u.noop:k,R=e.onRowUpdated,D=void 0===R?u.noop:R,L=e.onTableCreated,I=void 0===L?u.noop:L,F=e.onColumnSaved,U=void 0===F?u.noop:F,V=(0,p.x3)({arrayKeys:["filter","sort"]}),H=(0,i.Z)(V,2),W=(H[0],H[1]),M=(0,p.oR)(),Y=M.meta,J=M.ui,G=(0,f.NL)(),X=(0,l.useState)(!1),$=X[0],ee=X[1],ne=(0,l.useState)(!1),te=ne[0],re=ne[1],ae=Y.tables.list(),ie=(null!==(n=null===h||void 0===h?void 0:h.columns)&&void 0!==n?n:[]).filter((function(e){var n;return(null!==(n=null===e||void 0===e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()})).map((function(e){return e.name})),se=(0,B.d2)().project,oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,t=(0,C.Z)(e,A),r=(0,f.NL)();return(0,_.D)((function(e){return K(e)}),z({onSuccess:function(e,t,i){return(0,a.Z)(o().mark((function a(){var s,l;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t.projectRef,l=t.table,a.next=3,r.invalidateQueries(T.M.query(s,[l.schema,l.name]));case 3:return a.next=5,null===n||void 0===n?void 0:n(e,t,i);case 5:case"end":return a.stop()}}),a)})))()}},t))}(),le=oe.mutateAsync,ce=q({onMutate:function(e){return(0,a.Z)(o().mark((function n(){var t,r,a,s,l,c,d;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.projectRef,r=e.table,a=e.configuration,s=e.payload,S(),l=new Set(Object.keys(a.identifiers)),c=T.M.query(t,[r.schema,r.name,{table:{name:r.name,schema:r.schema}}]),n.next=6,G.cancelQueries(c);case 6:return d=G.getQueriesData(c),G.setQueriesData(c,(function(e){var n;return{result:null!==(n=null===e||void 0===e?void 0:e.result.map((function(e){return Object.entries(e).filter((function(e){var n=(0,i.Z)(e,1)[0];return l.has(n)})).every((function(e){var n=(0,i.Z)(e,2),t=n[0];return n[1]===a.identifiers[t]}))?De(De({},e),s):e})))&&void 0!==n?n:[]}})),n.abrupt("return",{previousRowsQueries:d});case 9:case"end":return n.stop()}}),n)})))()},onError:function(e,n,t){t.previousRowsQueries.forEach((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];r&&G.setQueriesData(t,r),G.invalidateQueries(t)}))}}).mutateAsync,de=function(){var e=(0,a.Z)(o().mark((function e(n,t,r,a){var i,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se&&void 0!==h){e.next=2;break}return e.abrupt("return",console.error("no project or table selected"));case 2:if(i=!1,!t){e.next=17;break}return e.prev=4,e.next=7,le({projectRef:se.ref,connectionString:se.connectionString,table:h,payload:n,enumArrayColumns:ie});case 7:s=e.sent,P(s[0]),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(4),i=!0,J.setNotification({category:"error",message:null===e.t0||void 0===e.t0?void 0:e.t0.message});case 15:e.next=36;break;case 17:if(!!(0,u.isEmpty)(n)){e.next=36;break}if(!(h.primary_keys.length>0)){e.next=34;break}if(!(h.primary_keys.length>0)){e.next=32;break}return e.prev=21,e.next=24,ce({projectRef:se.ref,connectionString:se.connectionString,table:h,configuration:r,payload:n,enumArrayColumns:ie});case 24:l=e.sent,D(l[0],r.rowIdx),e.next=32;break;case 28:e.prev=28,e.t1=e.catch(21),i=!0,J.setNotification({category:"error",message:null===e.t1||void 0===e.t1?void 0:e.t1.message});case 32:e.next=36;break;case 34:i=!0,J.setNotification({category:"error",message:"We can't make changes to this table because there is no primary key. Please create a primary key and try again."});case 36:a(),i||(ee(!1),S());case 38:case"end":return e.stop()}}),e,null,[[4,11],[21,28]])})));return function(n,t,r,a){return e.apply(this,arguments)}}(),ue=function(){var e=(0,a.Z)(o().mark((function e(n){var t,a,i,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==h&&void 0!==b){e.next=2;break}return e.abrupt("return");case 2:try{t=b.row,a=b.column,i=(0,r.Z)({},a,JSON.parse(n)),s={},h.primary_keys.forEach((function(e){return s[e.name]=t[e.name]})),!1,l={identifiers:s,rowIdx:t.idx},de(i,false,l,(function(){}))}catch(o){}case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),me=function(){var e=(0,a.Z)(o().mark((function e(n){var t,a,i,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==h&&void 0!==y){e.next=2;break}return e.abrupt("return");case 2:try{t=y.row,a=y.column,i=(0,r.Z)({},a.name,n),s={},h.primary_keys.forEach((function(e){return s[e.name]=t[e.name]})),!1,l={identifiers:s,rowIdx:t.idx},de(i,false,l,(function(){}))}catch(o){}case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),pe=function(){var e=(0,a.Z)(o().mark((function e(n,t,r,a,i){var s,l,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.columnId,l=(0,C.Z)(a,_e),!r){e.next=7;break}return e.next=4,Y.createColumn(n,h,t,l);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,Y.updateColumn(s,n,h,t);case 9:e.t0=e.sent;case 10:if(null===(c=e.t0)||void 0===c||!c.error){e.next=15;break}J.setNotification({category:"error",message:c.error.message}),e.next=22;break;case 15:return!r&&n.name&&x&&x.name!==n.name&&he(x.name,n.name),G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,["foreign-key-constraints"])),e.next=19,Promise.all([Y.tables.loadById(h.id),G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,[h.schema,h.name])),G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,["table-definition",h.schema,h.name])),G.invalidateQueries(E.C.list(null===se||void 0===se?void 0:se.ref))]);case 19:U(a.isEncrypted),ee(!1),S();case 22:if(!a.isEncrypted||null===h||void 0===h||!h.schema){e.next=25;break}return e.next=25,Y.views.loadBySchema(h.schema);case 25:i();case 26:case"end":return e.stop()}}),e)})));return function(n,t,r,a,i){return e.apply(this,arguments)}}(),he=function(e,n){W((function(t){var r,a,s=null!==(r=null===t||void 0===t?void 0:t.filter)&&void 0!==r?r:[],o=null!==(a=null===t||void 0===t?void 0:t.sort)&&void 0!==a?a:[];return De(De({},t),{},{filter:s.map((function(t){var r=t.split(":"),a=(0,i.Z)(r,1)[0];return a===e?t.replace(a,n):t})),sort:o.map((function(t){var r=t.split(":"),a=(0,i.Z)(r,1)[0];return a===e?t.replace(a,n):t}))})}))},ve=function(){var e=(0,a.Z)(o().mark((function e(n,t,r,a,i){var s,l,c,d,m,f,p,h,v,x,b,y;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=!1,c=a.tableId,d=a.importContent,m=a.isRLSEnabled,f=a.isRealtimeEnabled,p=a.isDuplicateRows,e.prev=2,!w){e.next=15;break}return h=(0,u.find)(ae,{id:c}),s=J.setNotification({category:"loading",message:"Duplicating table: ".concat(h.name,"...")}),e.next=8,Y.duplicateTable(n,{isRLSEnabled:m,isRealtimeEnabled:f,isDuplicateRows:p,duplicateTable:h});case 8:return v=e.sent,e.next=11,G.invalidateQueries(E.C.list(null===se||void 0===se?void 0:se.ref));case 11:J.setNotification({id:s,category:"success",message:"Table ".concat(h.name," has been successfully duplicated into ").concat(v.name,"!")}),I(v),e.next=41;break;case 15:if(!r){e.next=26;break}return s=J.setNotification({category:"loading",message:"Creating new table: ".concat(n.name,"...")}),e.next=19,Y.createTable(s,n,t,m,f,d);case 19:return x=e.sent,e.next=22,G.invalidateQueries(E.C.list(null===se||void 0===se?void 0:se.ref));case 22:J.setNotification({id:s,category:"success",message:"Table ".concat(x.name," is good to go!")}),I(x),e.next=41;break;case 26:if(!j){e.next=41;break}return s=J.setNotification({category:"loading",message:"Updating table: ".concat(null===j||void 0===j?void 0:j.name,"...")}),e.next=30,Y.updateTable(s,j,n,t,f);case 30:if(b=e.sent,y=b.table,!b.hasError){e.next=37;break}J.setNotification({id:s,category:"info",message:"Table ".concat(y.name," has been updated, but there were some errors")}),e.next=41;break;case 37:return G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,["foreign-key-constraints"])),e.next=40,Promise.all([G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,[j.schema,j.name])),G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,["table-definition",j.schema,j.name])),G.invalidateQueries(E.C.list(null===se||void 0===se?void 0:se.ref))]);case 40:J.setNotification({id:s,category:"success",message:"Successfully updated ".concat(y.name,"!")});case 41:e.next=47;break;case 43:e.prev=43,e.t0=e.catch(2),l=!0,J.setNotification({error:e.t0,id:s,category:"error",message:e.t0.message});case 47:l||(ee(!1),S()),i();case 49:case"end":return e.stop()}}),e,null,[[2,43]])})));return function(n,t,r,a,i){return e.apply(this,arguments)}}(),xe=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r,a,i,s,l,c,d,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(se&&void 0!==h){e.next=2;break}return e.abrupt("return",console.error("no project or table selected"));case 2:if(t=n.file,r=n.rowCount,a=n.selectedHeaders,i=n.resolve,s=J.setNotification({category:"loading",message:"Adding ".concat(r.toLocaleString()," rows to ").concat(h.name)}),!(t&&r>0)){e.next=14;break}return e.next=7,Y.insertRowsViaSpreadsheet(t,h,a,(function(e){J.setNotification({id:s,progress:e,category:"loading",message:"Adding ".concat(r.toLocaleString()," rows to ").concat(h.name)})}));case 7:if(l=e.sent,!(c=l.error)){e.next=12;break}return J.setNotification({error:c,id:s,category:"error",message:"Failed to import data: ".concat(c.message)}),e.abrupt("return",i());case 12:e.next=21;break;case 14:return e.next=16,Y.insertTableRows(h,n.rows,a,(function(e){J.setNotification({id:s,progress:e,category:"loading",message:"Adding ".concat(n.rows.length.toLocaleString()," rows to ").concat(h.name)})}));case 16:if(d=e.sent,!(u=d.error)){e.next=21;break}return J.setNotification({error:u,id:s,category:"error",message:"Failed to import data: ".concat(u.message)}),e.abrupt("return",i());case 21:return e.next=23,Promise.all([G.invalidateQueries(T.M.query(null===se||void 0===se?void 0:se.ref,[h.schema,h.name]))]);case 23:J.setNotification({id:s,category:"success",message:"Successfully imported ".concat(r," rows of data into ").concat(h.name)}),i(),S();case 26:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),je=function(){$?re(!0):S()};return(0,O.jsxs)(O.Fragment,{children:[!(0,u.isUndefined)(h)&&(0,O.jsx)(rn,{row:v,selectedTable:h,visible:"row"===g,closePanel:je,saveChanges:de,updateEditorDirty:function(){return ee(!0)}}),!(0,u.isUndefined)(h)&&(0,O.jsx)(Cn,{column:x,selectedTable:h,visible:"column"===g,closePanel:je,saveChanges:pe,updateEditorDirty:function(){return ee(!0)}}),(0,O.jsx)(rt,{table:j,selectedSchema:m,isDuplicating:w,visible:"table"===g,closePanel:je,saveChanges:ve,updateEditorDirty:function(){return ee(!0)}}),(0,O.jsx)(fe,{visible:"json"===g,column:null!==(t=null===b||void 0===b?void 0:b.column)&&void 0!==t?t:"",jsonString:null!==(s=null===b||void 0===b?void 0:b.jsonString)&&void 0!==s?s:"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",closePanel:je,onSaveJSON:ue}),(0,O.jsx)(Ee,{visible:"foreign-row-selector"===g,foreignKey:null===y||void 0===y?void 0:y.foreignKey,closePanel:je,onSelect:me},"foreign-row-selector-".concat(null!==(c=null===y||void 0===y||null===(d=y.foreignKey)||void 0===d?void 0:d.id)&&void 0!==c?c:"null")),(0,O.jsx)(Ct,{visible:"csv-import"===g,selectedTable:j,saveContent:xe,closePanel:je,updateEditorDirty:ee}),(0,O.jsx)(Q.Z,{visible:te,header:"Confirm to close",buttonLabel:"Confirm",onSelectCancel:function(){return re(!1)},onSelectConfirm:function(){re(!1),ee(!1),S()},children:(0,O.jsx)(Z.C.Content,{children:(0,O.jsx)("p",{className:"py-4 text-sm text-scale-1100",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})})]})},Ae=t(30336),Le=function(e){var n=e.isNewRecord,t=e.tableName,r="".concat(n?"Add new":"Update"," row ").concat(n?"to":"from"," ");return(0,O.jsxs)(O.Fragment,{children:[r,t&&(0,O.jsx)("span",{className:"text-code font-mono",children:t})]})},ze=t(44285),Ie=t(3648),Ke=t(81396),Fe=t(64124),Ue=t(93986),Ve=t(58728),He=t(53797);function We(e){return n=e,He.lb.indexOf(n.toLowerCase())>-1?"date":function(e){return He.XO.indexOf(e.toLowerCase())>-1}(e)?"time":function(e){return He.Ks.indexOf(e.toLowerCase())>-1}(e)?"datetime-local":"text";var n}var Me=t(27693),Ye=t.n(Me),qe=function(e){var n=e.value,t=e.onChange,r=e.name,a=e.format,i=e.description,s=We(a);return(0,O.jsx)(Ie.Z,{layout:"horizontal",className:"w-full",label:r,descriptionText:(0,O.jsxs)("div",{className:"space-y-1",children:[i,a.includes("tz")&&(0,O.jsxs)("p",{children:["Your local timezone will be automatically applied (",Ye()().format("ZZ"),")"]})]}),labelOptional:a,size:"small",value:n,type:s,onChange:function(e){var n=e.target.value;0===n.length&&""!==n||t(n)},step:"datetime-local"==s||"time"==s?"1":void 0})},Be=function(e){var n,t,a,i,s,o,l,c,d=e.field,m=e.errors,f=e.isEditable,p=void 0===f||f,h=e.onUpdateField,v=void 0===h?u.noop:h,x=e.onEditJson,j=void 0===x?u.noop:x,y=e.onSelectForeignKey,g=void 0===y?u.noop:y;if(d.enums.length>0)return"_"===d.format[0]?(0,O.jsx)("div",{className:"text-area-text-sm",children:(0,O.jsx)(Ie.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!p,error:m[d.name],rows:5,value:null!==(t=d.value)&&void 0!==t?t:"",placeholder:null===d.defaultValue?"":"string"===typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"Default: ".concat(d.defaultValue),onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))}})}):(0,O.jsxs)(Ke.ZP,{size:"medium",layout:"horizontal",value:null!==(a=d.value)&&void 0!==a?a:"",label:d.name,labelOptional:d.format,descriptionText:d.comment,disabled:!p,error:m[d.name],onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))},children:[(0,O.jsx)(Ke.ZP.Option,{value:"",children:"---"}),d.enums.map((function(e){return(0,O.jsx)(Ke.ZP.Option,{value:e,children:e},e)}))]});if(void 0!==d.foreignKey)return(0,O.jsx)(Ie.Z,{layout:"horizontal",label:d.name,value:null!==(i=d.value)&&void 0!==i?i:"",descriptionText:(0,O.jsxs)(O.Fragment,{children:[d.comment&&(0,O.jsxs)("span",{className:"text-sm text-scale-900",children:[d.comment," "]}),(0,O.jsxs)("span",{className:"text-sm text-scale-900",children:[d.comment&&"(","Has a foreign key relation to"]}),(0,O.jsxs)("span",{className:"text-code font-mono text-xs text-scale-900",children:[d.foreignKey.target_table_schema,".",d.foreignKey.target_table_name,".",d.foreignKey.target_column_name]}),d.comment&&(0,O.jsx)("span",{className:"text-sm text-scale-900",children:")"})]}),labelOptional:d.format,disabled:!p,error:m[d.name],onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))},actions:(0,O.jsx)(b.z,{type:"default",className:"mr-1",htmlType:"button",onClick:g,icon:(0,O.jsx)(Fe.Z,{}),children:"Select record"})});if((0,u.includes)(He.BB,d.format))return(0,O.jsx)("div",{className:"text-area-text-sm",children:(0,O.jsx)(Ie.Z.TextArea,{layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!p,error:m[d.name],rows:5,value:null!==(s=d.value)&&void 0!==s?s:"",placeholder:null===d.value&&null===d.defaultValue?"NULL":""===d.value||"string"===typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"NULL (Default: ".concat(d.defaultValue,")"),actions:(0,O.jsx)("div",{className:"mr-1 mt-0.5",children:(d.isNullable||!d.isNullable&&d.defaultValue)&&(0,O.jsx)(b.z,{type:"default",size:"tiny",onClick:function(){return v((0,r.Z)({},d.name,null))},children:"Set to NULL"})}),onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))}})});if((0,u.includes)(He.YF,d.format))return(0,O.jsx)(Ie.Z,{layout:"horizontal",value:null!==(o=d.value)&&void 0!==o?o:"",label:d.name,descriptionText:d.comment,labelOptional:d.format,disabled:!p,placeholder:null!==(l=null===d||void 0===d?void 0:d.defaultValue)&&void 0!==l?l:"NULL",error:m[d.name],onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))},actions:(0,O.jsx)(b.z,{type:"default",htmlType:"button",onClick:function(){return j({column:d.name,jsonString:d.value})},icon:(0,O.jsx)(Ue.Z,{}),children:"Edit JSON"})});if((0,u.includes)(He.nA,d.format))return(0,O.jsx)(qe,{name:d.name,format:d.format,value:null!==(c=d.value)&&void 0!==c?c:"",description:(0,O.jsxs)(O.Fragment,{children:[d.defaultValue&&(0,O.jsxs)("p",{children:["Default: ",d.defaultValue]}),d.comment&&(0,O.jsx)("p",{children:d.comment})]}),onChange:function(e){return v((0,r.Z)({},d.name,e))}});if("bool"===d.format){var N=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"}].concat((0,ze.Z)(d.isNullable?[{value:"null",label:"NULL"}]:[]));return(0,O.jsx)(Ve.Z,{size:"small",layout:"horizontal",name:d.name,label:d.name,labelOptional:d.format,descriptionText:d.comment,defaultValue:d.value,onChange:function(e){v("null"===e?(0,r.Z)({},d.name,null):(0,r.Z)({},d.name,e))},children:N.map((function(e){return(0,O.jsx)(Ve.Z.Option,{id:e.value,label:e.label,value:e.value,children:e.label},e.value)}))})}return(0,O.jsx)(Ie.Z,{layout:"horizontal",label:d.name,descriptionText:d.comment,labelOptional:d.format,error:m[d.name],value:null!==(n=d.value)&&void 0!==n?n:"",placeholder:d.isIdentity?"Automatically generated as identity":null!==d.defaultValue?"Default: ".concat(d.defaultValue):"NULL",disabled:!p,onChange:function(e){return v((0,r.Z)({},d.name,e.target.value))}})},Qe=fe,Je=function(e,n){try{return null===e||0===e.length?e:"number"!==typeof e&&n?"object"===typeof e?JSON.stringify(e):"boolean"===typeof e?e.toString():e:e}catch(t){return e}},Ge=function(e){if(!e)return"";var n,t,r=(0,u.compact)(e.split("\n"));return 1==r.length?e:2==r.length?"".concat(r[0]," ").concat(null===(n=r[1])||void 0===n?void 0:n.split(".<")[0]):r.length>2?"".concat(r[0]," (").concat(r[1]," ").concat(null===(t=r[2])||void 0===t?void 0:t.split(".<")[0],")"):""},Xe=function(e,n){if(!n||0==n.length)return"";if(He.Ks.includes(e))return Ye()(n).format("YYYY-MM-DDTHH:mm:ss");if(He.XO.includes(e)){var t=n&&n.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return Ye()(n,t).format("HH:mm:ss")}return n},$e=function(e,n){if(!n||0==n.length)return null;switch(e){case"timestamptz":return Ye()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return Ye()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return Ye()(n,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return Ye()(n,"HH:mm:ss").format("HH:mm:ss");default:return n}},en=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t={};return e.forEach((function(e){var n,r=e.format.startsWith("_"),a=He.BB.includes(e.format)?e.value:0===(null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:"").length?null:e.value;if(r&&null!==a)t[e.name]=(0,me.dW)(a);else if(e.format.includes("json"))"object"===typeof e.value?t[e.name]=a:(0,u.isString)(a)&&(t[e.name]=(0,me.dW)(a));else if("bool"===e.format&&a)t[e.name]="null"===a?null:"true"===a;else if(He.nA.includes(e.format)){var i=2===(a||"").split(":").length?"".concat(a,":00"):a;t[e.name]=$e(e.format,i)}else t[e.name]=a})),n?t:(0,u.omitBy)(t,u.isNull)};function nn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function tn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nn(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var rn=function(e){var n,t,s,c,d=e.row,m=e.selectedTable,f=e.visible,p=void 0!==f&&f,h=e.closePanel,v=void 0===h?u.noop:h,x=e.saveChanges,j=void 0===x?u.noop:x,b=e.updateEditorDirty,y=void 0===b?u.noop:b,g=(0,l.useState)({}),N=g[0],w=g[1],S=(0,l.useState)([]),k=S[0],P=S[1],C=(0,l.useState)(),Z=C[0],E=C[1],_=(0,l.useState)(!1),R=_[0],D=_[1],T=(0,l.useState)(),A=T[0],L=T[1],z=(0,u.isUndefined)(d),I=!(0,u.isUndefined)(Z),K=(0,l.useState)(!1),F=K[0],U=K[1],V=(0,u.partition)(k,(function(e){return!e.isNullable})),H=(0,i.Z)(V,2),W=H[0],M=H[1],Y=(0,B.d2)().project,q=(0,Ae.XJ)({projectRef:null===Y||void 0===Y?void 0:Y.ref,connectionString:null===Y||void 0===Y?void 0:Y.connectionString,schema:m.schema}).data,Q=(0,l.useMemo)((function(){var e;return q&&null!==A&&void 0!==A&&null!==(e=A.foreignKey)&&void 0!==e&&e.id?q.find((function(e){var n;return e.id===(null===(n=A.foreignKey)||void 0===n?void 0:n.id)})):void 0}),[q,null===A||void 0===A||null===(n=A.foreignKey)||void 0===n?void 0:n.id]);(0,l.useEffect)((function(){if(p){w({});var e=function(e,n){var t=n.relationships,r=n.primary_keys.map((function(e){return e.name}));return n.columns.map((function(n){return{value:(0,u.isUndefined)(e)&&He.BB.includes(n.format)?null:(0,u.isUndefined)(e)&&"bool"===n.format&&!n.is_nullable?"true":(0,u.isUndefined)(e)&&"bool"===n.format&&n.is_nullable?"null":(0,u.isUndefined)(e)?"":He.nA.includes(n.format)?Xe(n.format,e[n.name]):Je(e[n.name],n.format),foreignKey:(0,u.find)(t,(function(e){return e.source_schema===n.schema&&e.source_table_name===n.table&&e.source_column_name===n.name})),id:n.id,name:n.name,comment:Ge(n.comment),format:n.format,enums:n.enums,defaultValue:null===n||void 0===n?void 0:n.default_value,isNullable:n.is_nullable,isIdentity:n.is_identity,isPrimaryKey:r.includes(n.name)}}))}(d,m);P(e)}}),[p]);var G=function(e){var n=Object.keys(e),t=(0,i.Z)(n,1)[0],r=k.map((function(n){return n.name===t?tn(tn({},n),{},{value:e[t]}):n}));P(r),y()},X=function(){var e=(0,a.Z)(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!0),L(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),$=function(e){e.preventDefault();var n=function(e){var n={};return e.forEach((function(e){var t,r;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(i){n[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(t=null===(r=e.value)||void 0===r?void 0:r.length)&&void 0!==t?t:0)>0)try{var a;(0,me.jn)(null!==(a=e.value)&&void 0!==a?a:"")}catch(s){n[e.name]="Value is an invalid JSON"}!e.isIdentity&&e.defaultValue})),n}(k);if(w(n),U(!0),(0,u.isEmpty)(n)){y();var t=z?en(k):function(e,n){var t=en(n,!0),r={};return Object.keys(t).forEach((function(n){(0,u.isEqual)(e[n],t[n])||(r[n]=t[n])})),r}(d,k),r={identifiers:{},rowIdx:-1};if(!z){var a=k.filter((function(e){return e.isPrimaryKey})),i={};a.forEach((function(e){return i[e.name]=d[e.name]})),r.identifiers=i,r.rowIdx=d.idx}j(t,z,r,(function(){return U(!1)}))}else U(!1)};return(0,O.jsxs)(J.ZP,{hideFooter:!0,size:"large",visible:p,header:(0,O.jsx)(Le,{isNewRecord:z,tableName:m.name}),className:"transition-all duration-100 ease-in ".concat(I||R?" mr-32":""),onCancel:v,children:[(0,O.jsx)("form",{onSubmit:function(e){return $(e)},className:"h-full",children:(0,O.jsxs)("div",{className:"flex h-full flex-col",children:[(0,O.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,O.jsx)(J.ZP.Content,{children:(0,O.jsx)("div",{className:"space-y-10 py-6",children:W.map((function(e){return(0,O.jsx)(Be,{field:e,errors:N,onUpdateField:G,onEditJson:E,onSelectForeignKey:function(){return X(e)}},e.id)}))})}),M.length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-10 py-6",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("h3",{className:"text-base text-scale-1200",children:"Optional Fields"}),(0,O.jsx)("p",{className:"text-sm text-scale-900",children:"These are columns that do not need any value"})]}),M.map((function(e){return(0,O.jsx)(Be,{field:e,errors:N,onUpdateField:G,onEditJson:E,onSelectForeignKey:function(){return X(e)}},e.id)}))]})})]}),(0,O.jsx)(Qe,{visible:I,column:null!==(t=null===Z||void 0===Z?void 0:Z.column)&&void 0!==t?t:"",jsonString:null!==(s=null===Z||void 0===Z?void 0:Z.jsonString)&&void 0!==s?s:"",closePanel:function(){return E(void 0)},onSaveJSON:function(e){var n;G((0,r.Z)({},null!==(n=null===Z||void 0===Z?void 0:Z.column)&&void 0!==n?n:"",e)),E(void 0)}})]}),(0,O.jsx)("div",{className:"flex-shrink",children:(0,O.jsx)(ue.Z,{loading:F,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:v})})]})}),(0,O.jsx)(Ee,{visible:R,foreignKey:Q,onSelect:function(e){A&&(G((0,r.Z)({},A.name,e)),D(!1),L(void 0))},closePanel:function(){D(!1),L(void 0)}},"foreign-row-selector-".concat(null!==(c=null===Q||void 0===Q?void 0:Q.id)&&void 0!==c?c:"null"))]},"RowEditor")},an=t(65961),sn=t(90907),on=t(17634),ln=function(e){var n=e.table,t=e.column;return t?(0,O.jsxs)(O.Fragment,{children:["Update column ",(0,O.jsx)("code",{children:t.name})," from ",(0,O.jsx)("code",{children:t.table})]}):(0,O.jsxs)(O.Fragment,{children:["Add new column to ",(0,O.jsx)("code",{children:n.name})]})},cn=t(75978),dn=t(84364),un=t(80178),mn=function(e){var n=e.column,t=e.originalForeignKey,r=e.onSelectEditRelation,a=void 0===r?function(){}:r,i=e.onSelectRemoveRelation,s=void 0===i?function(){}:i,o=e.onSelectCancelRemoveRelation;if((0,u.isUndefined)(t)&&(0,u.isUndefined)(null===n||void 0===n?void 0:n.foreignKey))return(0,O.jsx)(b.z,{type:"default",onClick:a,children:"Add foreign key relation"});switch((0,un.wO)(t,null===n||void 0===n?void 0:n.foreignKey)){case"Add":return(0,O.jsx)(pn,{columnName:n.name,foreignKey:n.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});case"Remove":return(0,O.jsx)(hn,{columnName:n.name,originalForeignKey:t,onSelectEditRelation:a,onSelectCancelRemoveRelation:o});case"Update":return(0,O.jsx)(vn,{columnName:n.name,originalForeignKey:t,updatedForeignKey:n.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});case"Info":return(0,O.jsx)(fn,{columnName:n.name,foreignKey:n.foreignKey,onSelectEditRelation:a,onSelectRemoveRelation:s});default:return(0,O.jsx)("div",{})}},fn=function(e){var n=e.columnName,t=e.foreignKey,r=e.onSelectEditRelation,a=e.onSelectRemoveRelation,i=(0,un.zI)(null===t||void 0===t?void 0:t.deletion_action);return(0,O.jsx)(k.Z,{block:!0,title:(0,O.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsx)("p",{className:"text-scale-1100",children:"This column has the following foreign key relation:"}),(0,O.jsxs)("div",{className:"flex items-center space-x-2 text-scale-1200",children:[(0,O.jsx)("span",{className:"text-xs text-code font-mono",children:n}),(0,O.jsx)(Ce.Z,{size:14,strokeWidth:2}),(0,O.jsxs)("span",{className:"text-xs text-code font-mono",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]}),void 0!==i&&(0,O.jsxs)(dn.Z,{color:"gray",children:["On delete: ",i]})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.z,{type:"outline",onClick:r,children:"Edit relation"}),(0,O.jsx)(b.z,{type:"outline",onClick:a,children:"Remove"})]})]})})},pn=function(e){var n=e.columnName,t=e.foreignKey,r=e.onSelectEditRelation,a=e.onSelectRemoveRelation,i=(0,un.zI)(null===t||void 0===t?void 0:t.deletion_action);return(0,O.jsx)(k.Z,{block:!0,title:(0,O.jsxs)("div",{className:"flex flex-col space-y-4 text-scale-1100",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("span",{children:["The following foreign key relation will be"," ",(0,O.jsx)("span",{className:"text-brand-900",children:"added"}),":"]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2 text-scale-1200",children:[(0,O.jsx)("span",{className:"".concat(n.length>0?"text-code font-mono text-xs":""," max-w-xs truncate"),children:n||"This column"}),(0,O.jsx)(Ce.Z,{size:14,strokeWidth:2}),(0,O.jsxs)("span",{className:"max-w-xs text-xs truncate text-code font-mono",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]}),void 0!==i&&(0,O.jsxs)(dn.Z,{color:"gray",children:["On delete: ",i]})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.z,{type:"outline",onClick:r,children:"Edit relation"}),(0,O.jsx)(b.z,{type:"outline",onClick:a,children:"Remove"})]})]})})},hn=function(e){var n=e.columnName,t=e.originalForeignKey,r=e.onSelectEditRelation,a=e.onSelectCancelRemoveRelation;return(0,O.jsx)(k.Z,{block:!0,title:(0,O.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("p",{className:"text-scale-1100",children:["The following foreign key relation will be"," ",(0,O.jsx)("span",{className:"text-amber-900",children:"removed"}),":"]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("code",{className:"text-xs font-mono",children:n}),(0,O.jsx)(Ce.Z,{size:14,strokeWidth:2}),(0,O.jsxs)("code",{className:"text-xs font-mono",children:[null===t||void 0===t?void 0:t.target_table_schema,".",null===t||void 0===t?void 0:t.target_table_name,".",null===t||void 0===t?void 0:t.target_column_name]})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.z,{type:"outline",onClick:r,children:"Edit relation"}),(0,O.jsx)(b.z,{type:"outline",onClick:a,children:"Cancel remove"})]})]})})},vn=function(e){var n=e.columnName,t=e.originalForeignKey,r=e.updatedForeignKey,a=e.onSelectEditRelation,i=e.onSelectRemoveRelation,s="".concat(null===t||void 0===t?void 0:t.target_table_schema,".").concat(null===t||void 0===t?void 0:t.target_table_name,".").concat(null===t||void 0===t?void 0:t.target_column_name),o="".concat(null===r||void 0===r?void 0:r.target_table_schema,".").concat(null===r||void 0===r?void 0:r.target_table_name,".").concat(null===r||void 0===r?void 0:r.target_column_name),l=(0,un.zI)(null===t||void 0===t?void 0:t.deletion_action),c=(0,un.zI)(null===r||void 0===r?void 0:r.deletion_action);return(0,O.jsx)(k.Z,{block:!0,title:(0,O.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("p",{children:["The foreign key relation will be ",(0,O.jsx)("span",{className:"text-brand-900",children:"updated"})," as such:"]}),(0,O.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,O.jsx)("code",{className:"text-xs font-mono",children:n}),(0,O.jsx)(Ce.Z,{className:"mt-1",size:14,strokeWidth:2}),(0,O.jsxs)("div",{className:"flex flex-col space-y-2",children:[s!==o&&(0,O.jsx)("p",{className:"line-through",children:(0,O.jsx)("code",{className:"text-xs font-mono",children:s})}),(0,O.jsx)("code",{className:"text-xs font-mono",children:o})]}),(0,O.jsxs)("div",{className:"flex flex-col space-y-2",children:[void 0!==l&&l!==c&&(0,O.jsxs)(dn.Z,{color:"gray",className:"line-through",children:["On delete: ",l]}),void 0!==c&&(0,O.jsx)("div",{children:(0,O.jsxs)(dn.Z,{color:"green",children:["On delete: ",c]})})]})]})]}),(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(b.z,{type:"outline",onClick:a,children:"Edit relation"}),(0,O.jsx)(b.z,{type:"outline",onClick:i,children:"Remove"})]})]})})},xn=t(2674),jn=t(2686),bn=function(e){var n=e.label,t=e.description,r=e.placeholder,a=e.size,i=e.layout,s=e.disabled,o=void 0!==s&&s,c=e.className,d=void 0===c?"":c,u=e.value,m=void 0===u?"":u,f=(e.format,e.suggestions),p=void 0===f?[]:f,h=e.suggestionsTooltip,v=e.suggestionsHeader,x=e.onChange,j=void 0===x?function(){}:x,y=e.onSelectSuggestion,g=void 0===y?function(){}:y,N=(0,l.useRef)(null),S=(0,l.useState)(p),k=S[0],P=S[1],C=k.length>0;(0,l.useEffect)((function(){P(p.slice(0,3))}),[p]);return(0,O.jsx)("div",{ref:N,className:"relative",children:(0,O.jsx)(Ie.Z,{label:n,descriptionText:t,placeholder:r,size:a,layout:i,disabled:o,className:d,type:"text",value:m,onChange:function(e){j(e);var n=e.target.value;if(p.length>3){var t=n?p.filter((function(e){return-1!==e.name.indexOf(n)})):p;P(t.slice(0,3))}},actions:C&&(0,O.jsx)(xn.ZP,{size:"medium",align:"end",side:"bottom",overlay:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(xn.ZP.Label,{children:v||"Suggestions"}),(0,O.jsx)(xn.ZP.Separator,{}),k.map((function(e){return(0,O.jsxs)(xn.ZP.Item,{onClick:function(){return g(e)},children:[(0,O.jsx)("div",{className:"text-sm",children:e.name}),(0,O.jsx)("div",{className:"text-xs text-scale-900",children:e.description})]},e.name)}))]}),children:(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{children:(0,O.jsx)(b.z,{as:"span",type:"default",className:"!px-1 mr-1",icon:(0,O.jsx)(jn.Z,{strokeWidth:1.5})})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["bg-scale-100 rounded py-1 px-2 leading-none shadow","border-scale-200 border"].join(" "),children:(0,O.jsx)("span",{className:"text-scale-1200 text-xs",children:h||"Suggestions"})})]})})]})})})})},yn=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],gn=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],Nn={uuid:[{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[].concat(yn),timetz:[].concat(yn),timestamp:[].concat(yn),timestamptz:[].concat(yn),text:[].concat(gn),varchar:[].concat(gn)},wn=function(e){var n,t,r=e.columnFields,a=e.enumTypes,i=void 0===a?[]:a,s=e.onUpdateField,o=void 0===s?function(){}:s,l=null!==(n=null===Nn||void 0===Nn?void 0:Nn[r.format])&&void 0!==n?n:[];if((0,u.isNil)(r.format)&&!He.DL.includes(r.format)){var c,d=(0,un.aN)(r.format,i);return(0,O.jsxs)(Ke.ZP,{label:"Default Value",layout:"horizontal",value:null!==(c=r.defaultValue)&&void 0!==c?c:"",onChange:function(e){return o({defaultValue:e.target.value})},children:[(0,O.jsx)(Ke.ZP.Option,{value:"",children:"---"},"empty-enum"),d.map((function(e){return(0,O.jsx)(Ke.ZP.Option,{value:e,children:e},e)}))]})}return(0,O.jsx)(bn,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"===typeof r.defaultValue&&0===r.defaultValue.length?"EMPTY":"NULL",value:null!==(t=null===r||void 0===r?void 0:r.defaultValue)&&void 0!==t?t:"",format:null===r||void 0===r?void 0:r.format,suggestions:l,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:function(e){return o({defaultValue:e.target.value})},onSelectSuggestion:function(e){return o({defaultValue:e.value})}})},On=t(33003),Sn=t(30113);function kn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Pn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?kn(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Cn=function(e){var n,t,r,a,s,o=e.column,c=e.selectedTable,d=e.visible,m=void 0!==d&&d,f=e.closePanel,h=void 0===f?u.noop:f,x=e.saveChanges,y=void 0===x?u.noop:x,g=e.updateEditorDirty,N=void 0===g?u.noop:g,w=(0,v.UO)().ref,S=(0,p.oR)(),k=S.meta,P=S.vault,C=(0,B.d2)().project,Z=(0,p.P5)("transparentColumnEncryption"),E=(0,l.useState)({}),_=E[0],R=E[1],D=(0,l.useState)(),T=D[0],A=D[1],L=(0,l.useState)(!1),z=L[0],I=L[1],K=(0,Ae.XJ)({projectRef:null===C||void 0===C?void 0:C.ref,connectionString:null===C||void 0===C?void 0:C.connectionString,schema:null===c||void 0===c?void 0:c.schema}).data||[],F=P.listKeys(),U=k.types.list((function(e){return!k.excludedSchemas.includes(e.schema)})),V=k.extensions.list((function(e){return"pgsodium"===e.name.toLowerCase()})),H=(0,i.Z)(V,1)[0],W=null!==(null===H||void 0===H?void 0:H.installed_version),M=void 0===o,Y=o?(0,un.S)(o,c,K):void 0;if((0,l.useEffect)((function(){if(m){R({});var e=M?Pn(Pn({},(0,un.QZ)()),{},{keyId:F.length>0?F[0].id:"create-new"}):(0,un.uE)(o,c,K);A(e)}}),[m]),!T)return null;var q=function(e){He.BB.includes(T.format)||""!==e.defaultValue||(e.defaultValue=null);var n=Pn(Pn({},T),e);A(n),N();for(var t=Pn({},_),r=0,a=Object.keys(e);r<a.length;r++){delete t[a[r]]}R(t)},Q=function(e){if(T){var n=(0,un.Of)(T);if(R(n),(0,u.isEmpty)(n)){var t=M?(0,un.oo)(c.id,T):(0,un.xY)(o,c,T),r=T.foreignKey?Pn(Pn({},T.foreignKey),{},{source_column_name:T.name}):void 0,a={columnId:null===o||void 0===o?void 0:o.id,isEncrypted:T.isEncrypted,keyId:T.keyId,keyName:T.keyName};y(t,r,M,a,e)}else e()}};return(0,O.jsxs)(J.ZP,{size:"xlarge",visible:m,onConfirm:function(e){return Q(e)},header:(0,O.jsx)(ln,{table:c,column:o}),onCancel:h,customFooter:(0,O.jsx)(ue.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:h,applyFunction:function(e){return Q(e)}}),children:[(0,O.jsx)(On.hj,{header:(0,O.jsx)(On.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,O.jsxs)(On.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,O.jsx)(Ie.Z,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:_.name,value:null!==(n=null===T||void 0===T?void 0:T.name)&&void 0!==n?n:"",onChange:function(e){return q({name:e.target.value})}}),(0,O.jsx)(Ie.Z,{label:"Description",labelOptional:"Optional",type:"text",value:null!==(t=null===T||void 0===T?void 0:T.comment)&&void 0!==t?t:"",onChange:function(e){return q({comment:e.target.value})}})]})}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(On.hj,{header:(0,O.jsx)(On.S0,{className:"lg:!col-span-4",children:"Foreign Key Relation"}),children:(0,O.jsx)(On.B4,{loading:!1,className:"lg:!col-span-8",children:(0,O.jsx)("div",{children:(0,O.jsx)(mn,{column:T,originalForeignKey:Y,onSelectEditRelation:function(){return I(!0)},onSelectRemoveRelation:function(){return q({foreignKey:void 0})},onSelectCancelRemoveRelation:function(){return q({foreignKey:Y})}})})})}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(On.hj,{header:(0,O.jsx)(On.S0,{className:"lg:!col-span-4",description:(0,O.jsx)(j(),{href:"https://supabase.com/docs/guides/database/tables#data-types",children:(0,O.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,O.jsx)(b.z,{as:"span",type:"default",size:"tiny",icon:(0,O.jsx)(an.Z,{size:14,strokeWidth:2}),children:"About data types"})})}),children:"Data Type"}),children:(0,O.jsxs)(On.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,O.jsx)(cn.Z,{showRecommendation:!0,value:null!==(r=null===T||void 0===T?void 0:T.format)&&void 0!==r?r:"",layout:"vertical",enumTypes:U,error:_.format,disabled:void 0!==(null===T||void 0===T?void 0:T.foreignKey),onOptionSelect:function(e){return q({format:e,defaultValue:null})}}),void 0===T.foreignKey&&(0,O.jsxs)("div",{className:"space-y-4",children:[T.format.includes("int")&&(0,O.jsx)("div",{className:"w-full",children:(0,O.jsx)(sn.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:T.isIdentity,onChange:function(){var e=!T.isIdentity,n=!e&&T.isArray;q({isIdentity:e,isArray:n})}})}),!T.isPrimaryKey&&(0,O.jsx)("div",{className:"w-full",children:(0,O.jsx)(sn.Z,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:T.isArray,onChange:function(){var e=!T.isArray,n=!e&&T.isIdentity;q({isArray:e,isIdentity:n})}})})]}),(0,O.jsx)(wn,{columnFields:T,enumTypes:U,onUpdateField:q})]})}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(On.hj,{header:(0,O.jsx)(On.S0,{className:"lg:!col-span-4",children:"Constraints"}),children:(0,O.jsxs)(On.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,O.jsx)(on.Z,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!==(a=null===T||void 0===T?void 0:T.isPrimaryKey)&&void 0!==a&&a,onChange:function(){return q({isPrimaryKey:!(null!==T&&void 0!==T&&T.isPrimaryKey)})}}),(0,O.jsx)(on.Z,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:T.isNullable,onChange:function(){return q({isNullable:!T.isNullable})}}),(0,O.jsx)(on.Z,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:T.isUnique,onChange:function(){return q({isUnique:!T.isUnique})}}),(0,O.jsx)(Ie.Z,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:"e.g length(".concat((null===T||void 0===T?void 0:T.name)||"column_name",") < 500"),type:"text",value:null!==(s=null===T||void 0===T?void 0:T.check)&&void 0!==s?s:"",onChange:function(e){return q({check:e.target.value})},className:"[&_input]:font-mono"})]})}),M&&Z&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(On.hj,{header:(0,O.jsx)(On.S0,{className:"lg:!col-span-4",children:"Security"}),children:(0,O.jsxs)(On.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,O.jsx)(on.Z,{label:"Encrypt Column",error:null===_||void 0===_?void 0:_.isEncrypted,disabled:!W,descriptionText:(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("p",{children:["Encrypt the column's data with pgsodium's Transparent Column Encryption (TCE). Decrypted values will be stored within the \"decrypted_",c.name,'" view.']}),W?(0,O.jsxs)("p",{children:["Note: Only columns of ",(0,O.jsx)("code",{className:"text-xs",children:"text"})," type can be encrypted."]}):(0,O.jsxs)("p",{children:["You will need to"," ",(0,O.jsx)(j(),{href:"/project/".concat(w,"/database/extensions?filter=pgsodium"),children:(0,O.jsx)("a",{className:"text-brand-800 hover:text-brand-900 transition",children:"install"})})," ","the extension ",(0,O.jsx)("code",{className:"text-xs",children:"pgsodium"})," first before being able to encrypt your column."]})]}),checked:T.isEncrypted,onChange:function(){return q({isEncrypted:!T.isEncrypted})}}),T.isEncrypted&&(0,O.jsx)(Sn.dF,{label:"Select a key to encrypt your column with",error:null===_||void 0===_?void 0:_.keyName,selectedKeyId:T.keyId,onSelectKey:function(e){return q({keyId:e})},onUpdateDescription:function(e){return q({keyName:e})}})]})})]}),(0,O.jsx)(Qn,{column:T,visible:z,closePanel:function(){return I(!1)},saveChanges:function(e){q(Pn({foreignKey:void 0!==e?{id:0,constraint_name:"",source_schema:c.schema,source_table_name:c.name,source_column_name:(null===T||void 0===T?void 0:T.name)||(null===o||void 0===o?void 0:o.name)||"",target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name,deletion_action:e.deletionAction}:void 0},void 0!==e&&{format:e.column.format,defaultValue:null})),I(!1)}})]},"ColumnEditor")},Zn=t(11597),En=t(49239),_n=function(e){var n=e.schema,t=e.table,r=e.isDuplicating;return t?r?(0,O.jsxs)(O.Fragment,{children:["Duplicate table ",(0,O.jsx)("code",{className:"text-sm",children:t.name})]}):(0,O.jsxs)(O.Fragment,{children:["Update table ",(0,O.jsx)("code",{className:"text-sm",children:t.name})]}):(0,O.jsxs)(O.Fragment,{children:["Create a new table under ",(0,O.jsx)("code",{className:"text-sm",children:n})]})},Rn=t(67863),Dn=t(44315),Tn=t(29432),An=t(3473),Ln=t(121),zn=t(4158),In=t(33759),Kn=t(70946),Fn=t(48049);function Un(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Vn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Un(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Un(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Hn=function(e){var n,t,r=e.column,a=void 0===r?{}:r,i=e.enumTypes,s=void 0===i?[]:i,o=e.isNewRecord,l=void 0!==o&&o,c=e.hasImportContent,d=void 0!==c&&c,u=e.dragHandleProps,m=void 0===u?{}:u,f=e.onEditRelation,p=void 0===f?function(){}:f,h=e.onUpdateColumn,v=void 0===h?function(){}:h,x=e.onRemoveColumn,j=void 0===x?function(){}:x,y=null!==(n=null===Nn||void 0===Nn?void 0:Nn[a.format])&&void 0!==n?n:[],g=[a.isNullable?1:0,a.isIdentity?1:0,a.isUnique?1:0,a.isArray?1:0].reduce((function(e,n){return e+n}),0);return(0,O.jsxs)("div",{className:"flex w-full items-center",children:[(0,O.jsx)("div",{className:"w-[5%] ".concat(l?"":"hidden"),children:(0,O.jsx)("div",Vn(Vn({className:"cursor-drag"},m),{},{children:(0,O.jsx)(Ln.Z,{strokeWidth:1,size:15})}))}),(0,O.jsx)("div",{className:"w-[20%]",children:(0,O.jsx)("div",{className:"flex w-[95%] items-center justify-between",children:(0,O.jsx)(Ie.Z,{value:a.name,size:"small",title:a.name,disabled:d,placeholder:"column_name",className:"table-editor-columns-input bg-white dark:bg-transparent lg:gap-0 ".concat(d?"opacity-50":""," rounded-md"),onChange:function(e){return v({name:e.target.value})}})})}),(0,O.jsx)("div",{className:"w-[5%] mr-2.5",children:(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{children:(0,O.jsx)(b.z,{type:void 0!==a.foreignKey?"secondary":"default",onClick:function(){return p(a)},className:"px-1 py-2",children:(0,O.jsx)(Fe.Z,{size:14,strokeWidth:void 0!==a.foreignKey?2:1})})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 "].join(" "),children:void 0===a.foreignKey?(0,O.jsx)("span",{className:"text-xs text-scale-1200",children:"Edit foreign key relation"}):(0,O.jsxs)("div",{children:[(0,O.jsx)("p",{className:"text-xs text-scale-1100",children:"Foreign key relation:"}),(0,O.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,O.jsxs)("p",{className:"text-xs text-scale-1200",children:[a.foreignKey.source_schema,".",a.foreignKey.source_table_name,".",a.foreignKey.source_column_name]}),(0,O.jsx)(Ce.Z,{size:"tiny",strokeWidth:1.5}),(0,O.jsxs)("p",{className:"text-xs text-scale-1200",children:[a.foreignKey.target_table_schema,".",a.foreignKey.target_table_name,".",a.foreignKey.target_column_name]})]}),a.foreignKey.deletion_action!==Fn.HO.NO_ACTION&&(0,O.jsxs)("p",{className:"text-xs text-scale-1200 mt-1",children:["On delete: ",(0,un.zI)(a.foreignKey.deletion_action)]})]})})]})})]})}),(0,O.jsx)("div",{className:"w-[25%]",children:(0,O.jsx)("div",{className:"w-[95%]",children:(0,O.jsx)(cn.Z,{value:a.format,enumTypes:s,size:"small",showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:void 0!==a.foreignKey,onOptionSelect:function(e){v({format:e,defaultValue:null})}})})}),(0,O.jsx)("div",{className:"".concat(l?"w-[25%]":"w-[30%]"),children:(0,O.jsx)("div",{className:"w-[95%]",children:(0,O.jsx)(bn,{placeholder:"string"===typeof a.defaultValue&&0===a.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!==(t=a.defaultValue)&&void 0!==t?t:"",disabled:a.format.includes("int")&&a.isIdentity,className:"rounded bg-white dark:bg-transparent lg:gap-0 ".concat(a.format.includes("int")&&a.isIdentity?"opacity-50":""),suggestions:y,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:function(e){return v({defaultValue:e.target.value})},onSelectSuggestion:function(e){return v({defaultValue:e.value})}})})}),(0,O.jsx)("div",{className:"w-[10%]",children:(0,O.jsx)(sn.Z,{label:"",checked:a.isPrimaryKey,onChange:function(){return v({isPrimaryKey:!a.isPrimaryKey})}})}),(0,O.jsx)("div",{className:"".concat(d?"w-[10%]":"w-[0%]")}),(0,O.jsx)("div",{className:"flex w-[5%] justify-end",children:(!a.isPrimaryKey||a.format.includes("int"))&&(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(zn.Z,{size:"xlarge",className:"pointer-events-auto",align:"end",header:(0,O.jsx)("div",{className:"flex items-center justify-center",children:(0,O.jsx)("h5",{className:"text-sm text-scale-1200",children:"Extra options"})}),overlay:[(0,O.jsxs)("div",{className:"flex flex-col space-y-1",children:[!a.isPrimaryKey&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(sn.Z,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:a.isNullable,className:"p-4",onChange:function(){return v({isNullable:!a.isNullable})}}),(0,O.jsx)(zn.Z.Separator,{})]}),a.isNewColumn&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(sn.Z,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:a.isUnique,className:"p-4",onChange:function(){return v({isUnique:!a.isUnique})}}),(0,O.jsx)(zn.Z.Separator,{})]}),a.format.includes("int")&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(sn.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:a.isIdentity,className:"p-4",onChange:function(){var e=!a.isIdentity,n=!e&&a.isArray;v({isIdentity:e,isArray:n})}}),(0,O.jsx)(zn.Z.Separator,{})]}),!a.isPrimaryKey&&(0,O.jsx)(sn.Z,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:a.isArray,className:"p-4",onChange:function(){var e=!a.isArray,n=!e&&a.isIdentity;v({isArray:e,isIdentity:n})}})]},"".concat(a.id,"_configuration"))],children:(0,O.jsxs)("div",{className:"group flex items-center -space-x-1",children:[g>0&&(0,O.jsx)("div",{className:"rounded-full bg-scale-1200 py-0.5 px-2 text-xs text-scale-100 dark:bg-scale-100 dark:text-scale-1100",children:g}),(0,O.jsx)("div",{className:"text-scale-1100 transition-colors group-hover:text-scale-1200",children:(0,O.jsx)(In.Z,{size:18,strokeWidth:1})})]})})})}),!d&&(0,O.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,O.jsx)("button",{className:"cursor-pointer",onClick:function(){return j()},children:(0,O.jsx)(Kn.Z,{strokeWidth:1})})})]})},Wn=t(34789),Mn=[{key:"no-action",label:"No action",value:Fn.HO.NO_ACTION},{key:"cascade",label:"Cascade",value:Fn.HO.CASCADE},{key:"restrict",label:"Restrict",value:Fn.HO.RESTRICT},{key:"set-default",label:"Set default",value:Fn.HO.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:Fn.HO.SET_NULL}],Yn=function(e,n){var t,r=null!==(t=(0,un.zI)(e))&&void 0!==t?t:"No action";switch(e){case Fn.HO.NO_ACTION:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{className:"text-scale-1100",children:r}),": Deleting a record from"," ",(0,O.jsx)("code",{className:"text-xs text-scale-1100",children:n})," will"," ",(0,O.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case Fn.HO.CASCADE:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{className:"text-scale-1100",children:r}),": Deleting a record from"," ",(0,O.jsx)("code",{className:"text-xs text-scale-1100",children:n})," will"," ",(0,O.jsx)("span",{className:"text-amber-900 opacity-75",children:"also delete"})," any records that reference it in this table"]});case Fn.HO.RESTRICT:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{className:"text-scale-1100",children:r}),(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{className:"translate-y-[3px] mx-1",children:(0,O.jsx)(Tn.Z,{className:"text-scale-1100",size:16,strokeWidth:1.5})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","w-[300px] space-y-2 border border-scale-200"].join(" "),children:(0,O.jsx)("p",{className:"text-xs text-scale-1200",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})})]})})]}),": Deleting a record from ",(0,O.jsx)("code",{className:"text-xs text-scale-1100",children:n})," will"," ",(0,O.jsx)("span",{className:"text-amber-900 opacity-75",children:"prevent deletion"})," of existing referencing rows from this table."]});case Fn.HO.SET_DEFAULT:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{className:"text-scale-1100",children:r}),": Deleting a record from"," ",(0,O.jsx)("code",{className:"text-xs text-scale-1100",children:n})," will set the value of any existing records in this table referencing it to their"," ",(0,O.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case Fn.HO.SET_NULL:return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("span",{className:"text-scale-1100",children:r}),": Deleting a record from"," ",(0,O.jsx)("code",{className:"text-xs text-scale-1100",children:n})," will set the value of any existing records in this table referencing it"," ",(0,O.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}};function qn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Bn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?qn(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Qn=function(e){var n,t,r,a,i=e.column,s=e.visible,o=void 0!==s&&s,c=e.closePanel,d=e.saveChanges,m=(0,p.oR)().meta,f=(0,l.useState)({}),h=f[0],v=f[1],x=(0,l.useState)({schema:"public",table:"",column:"",deletionAction:Fn.HO.NO_ACTION}),j=x[0],b=x[1],y=m.schemas.list(),g=m.tables.list((function(e){return e.schema===j.schema})),N=null===i||void 0===i?void 0:i.foreignKey,w=(0,u.find)(g,{name:null===j||void 0===j?void 0:j.table,schema:null===j||void 0===j?void 0:j.schema}),S=(0,u.find)(null!==(n=null===w||void 0===w?void 0:w.columns)&&void 0!==n?n:[],{name:null===j||void 0===j?void 0:j.column});(0,l.useEffect)((function(){m.tables.loadBySchema("public")}),[]),(0,l.useEffect)((function(){o&&(v({}),b(N?{schema:N.target_table_schema,table:N.target_table_name,column:N.target_column_name,deletionAction:N.deletion_action}:{schema:"public",table:"",column:"",deletionAction:Fn.HO.NO_ACTION}))}),[o]);return(0,O.jsx)(J.ZP,{size:"medium",visible:o,onCancel:c,header:(0,O.jsxs)("span",{children:["Edit foreign key relation"," ",(null===i||void 0===i?void 0:i.name)&&(0,O.jsxs)(O.Fragment,{children:["for ",(0,O.jsx)("span",{className:"text-code",children:(0,u.get)(i,["name"],"")})]})]}),customFooter:(0,O.jsx)(ue.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:c,applyFunction:function(e){var n={};null!==j&&void 0!==j&&j.table||(n.table="Please select a table"),null!==j&&void 0!==j&&j.table&&!j.column&&(n.column="The table ".concat(j.table," has no columns")),v(n),(0,u.isEmpty)(n)&&d(w&&S?{table:w,column:S,deletionAction:j.deletionAction}:void 0),e()}}),children:(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"py-6 space-y-6",children:[(0,O.jsx)(k.Z,{icon:(0,O.jsx)(Tn.Z,{size:"large",strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,O.jsx)(Ve.Z,{id:"schema",label:"Select a schema",value:j.schema,error:h.schema,onChange:function(e){return function(e){m.tables.loadBySchema(e);var n={schema:e,table:"",column:"",deletionAction:Fn.HO.NO_ACTION};b(n)}(e)},children:y.map((function(e){return(0,O.jsx)(Ve.Z.Option,{value:e.name,label:e.name,addOnBefore:function(){return(0,O.jsx)(Wn.Z,{size:16,strokeWidth:1.5})},children:(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("span",{className:"hidden",children:e.name}),(0,O.jsx)("span",{className:"text-scale-1200",children:e.name})]})},e.id)}))}),(0,O.jsxs)(Ve.Z,{id:"table",label:"Select a table to reference to",value:null!==(t=null===w||void 0===w?void 0:w.id)&&void 0!==t?t:1,error:h.table,onChange:function(e){return function(e){v({}),e||b({schema:"",table:"",column:"",deletionAction:Fn.HO.NO_ACTION});var n,t=(0,u.find)(g,{id:e});t&&b({schema:t.schema,table:t.name,column:null!==(n=t.columns)&&void 0!==n&&n.length?t.columns[0].name:void 0,deletionAction:Fn.HO.NO_ACTION})}(Number(e))},children:[(0,O.jsx)(Ve.Z.Option,{value:1,label:"---",children:"---"},"empty"),(0,u.sortBy)(g,["schema"]).map((function(e){return(0,O.jsx)(Ve.Z.Option,{value:e.id,label:e.name,children:(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("span",{className:"hidden",children:e.name}),(0,O.jsx)("span",{className:"text-scale-900",children:e.schema}),(0,O.jsx)("span",{className:"text-scale-1200",children:e.name})]})},e.id)}))]}),(null===j||void 0===j?void 0:j.table)&&(0,O.jsxs)(O.Fragment,{children:[0===(null!==(r=null===w||void 0===w?void 0:w.columns)&&void 0!==r?r:[]).length?(0,O.jsx)(Ie.Z,{disabled:!0,label:(0,O.jsxs)("div",{children:["Select a column from"," ",(0,O.jsxs)("code",{className:"text-xs",children:[null===j||void 0===j?void 0:j.schema,".",null===j||void 0===j?void 0:j.table]})," ","to reference to"]}),error:h.column,placeholder:"This table has no columns available"}):(0,O.jsx)(Ve.Z,{id:"column",value:null===S||void 0===S?void 0:S.id,label:(0,O.jsxs)("div",{children:["Select a column from"," ",(0,O.jsxs)("code",{className:"text-xs",children:[null===j||void 0===j?void 0:j.schema,".",null===j||void 0===j?void 0:j.table]})," ","to reference to"]}),error:h.column,onChange:function(e){return function(e){v({});var n=(0,u.find)(null===w||void 0===w?void 0:w.columns,{id:e});if(n){var t=Bn(Bn({},j),{},{column:n.name});b(t)}}(e)},children:(null!==(a=null===w||void 0===w?void 0:w.columns)&&void 0!==a?a:[]).map((function(e){return(0,O.jsx)(Ve.Z.Option,{value:e.id,label:e.name,children:(0,O.jsxs)("div",{className:"flex items-center gap-2",children:[(0,O.jsx)("span",{className:"text-scale-1200",children:e.name}),(0,O.jsx)("span",{className:"text-scale-900",children:e.format})]})},e.id)}))}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(k.Z,{icon:(0,O.jsx)(Tn.Z,{size:"large",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,O.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,O.jsxs)("li",{children:[(0,O.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,O.jsxs)("li",{children:[(0,O.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,O.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,O.jsxs)("li",{children:[(0,O.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,O.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,O.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,O.jsx)(Ve.Z,{id:"deletionAction",value:j.deletionAction,label:"Action if referenced row is removed",descriptionText:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("p",{children:Yn(j.deletionAction,"".concat(j.schema,".").concat(j.table))}),(0,O.jsx)("p",{className:"mt-2",children:(0,O.jsx)("a",{href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes",target:"_blank",rel:"noreferrer",className:"text-brand-900 opacity-75",children:"Learn more about cascade deletes"})})]}),error:h.column,onChange:function(e){return function(e){v({}),b(Bn(Bn({},j),{},{deletionAction:e}))}(e)},children:Mn.map((function(e){return(0,O.jsx)(Ve.Z.Option,{value:e.value,label:e.label,children:(0,O.jsx)("p",{className:"text-scale-1200",children:e.label})},e.key)}))})]})]})})},"ForeignKeySelector")};function Jn(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Gn(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Jn(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Jn(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Xn=function(e){var n,t=e.table,r=e.columns,a=void 0===r?[]:r,s=e.enumTypes,o=void 0===s?[]:s,c=e.importContent,d=e.isNewRecord,m=e.onColumnsUpdated,f=void 0===m?function(){}:m,p=e.onSelectImportData,h=void 0===p?function(){}:p,v=e.onClearImportContent,x=void 0===v?function(){}:v,y=(0,l.useState)(),g=y[0],N=y[1],S=!(0,u.isEmpty)(c),P=(0,u.partition)(a,(function(e){return e.isPrimaryKey})),C=(0,i.Z)(P,2),Z=C[0],E=C[1],_=function(e,n){var t=a.map((function(t){if(t.id===e.id){if(He.BB.includes(e.format)||""!==n.defaultValue||(n.defaultValue=null),"name"in n&&void 0!==t.foreignKey){var r,a=Gn(Gn({},t.foreignKey),{},{source_column_name:null!==(r=null===n||void 0===n?void 0:n.name)&&void 0!==r?r:""});return Gn(Gn(Gn({},t),n),{},{foreignKey:a})}return Gn(Gn({},t),n)}return t}));f(t)},R=function(e){var n=a.filter((function(n){return n.id!==e.id}));f(n)},D=function(e,n){if(e.destination){if("pks"===n){var t=Z.slice(),r=t.splice(e.source.index,1),a=(0,i.Z)(r,1)[0];t.splice(e.destination.index,0,a);var s=t.concat(E);return f(s)}if("others"===n){var o=E.slice(),l=o.splice(e.source.index,1),c=(0,i.Z)(l,1)[0];o.splice(e.destination.index,0,c);var d=Z.concat(o);return f(d)}}};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,O.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,O.jsx)("h5",{children:"Columns"}),d&&(0,O.jsx)(O.Fragment,{children:S?(0,O.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,O.jsx)(b.z,{type:"default",icon:(0,O.jsx)(Rn.Z,{}),onClick:h,children:"Edit content"}),(0,O.jsx)(b.z,{danger:!0,type:"outline",icon:(0,O.jsx)(Dn.Z,{}),onClick:x,children:"Remove content"})]}):(0,O.jsx)(b.z,{type:"default",onClick:h,children:"Import data via spreadsheet"})})]}),S&&(0,O.jsxs)("p",{className:"text-sm text-scale-1000 my-2",children:["Your table will be created with ",null===c||void 0===c||null===(n=c.rowCount)||void 0===n?void 0:n.toLocaleString()," rows and the following ",a.length," columns."]}),0===Z.length&&(0,O.jsx)(Zn.Z,{title:"Warning: No primary keys selected",variant:"warning",withIcon:!0,children:"Tables require at least one column as a primary key in order to uniquely identify each row. Without a primary key, you will not be able to update or delete rows from the table."}),Z.length>1&&(0,O.jsx)(k.Z,{block:!0,icon:(0,O.jsx)(we.Z,{className:"text-white",size:"large"}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("div",{className:"flex w-full px-3",children:[d&&(0,O.jsx)("div",{className:"w-[5%]"}),(0,O.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:"Name"}),(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{children:(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:(0,O.jsx)(Tn.Z,{size:15,strokeWidth:1.5})})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 "].join(" "),children:(0,O.jsx)("span",{className:"text-xs text-scale-1200",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})})]})})]})]}),(0,O.jsx)("div",{className:"w-[25%]",children:(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:"Type"})}),(0,O.jsxs)("div",{className:"".concat(d?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:"Default Value"}),(0,O.jsxs)(w.fC,{delayDuration:0,children:[(0,O.jsx)(w.xz,{children:(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:(0,O.jsx)(Tn.Z,{size:15,strokeWidth:1.5})})}),(0,O.jsx)(w.h_,{children:(0,O.jsxs)(w.VY,{side:"bottom",children:[(0,O.jsx)(w.Eh,{className:"radix-tooltip-arrow"}),(0,O.jsx)("div",{className:["rounded bg-scale-100 py-1 px-2 leading-none shadow","border border-scale-200 "].join(" "),children:(0,O.jsx)("span",{className:"text-xs text-scale-1200",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})})]})})]})]}),(0,O.jsx)("div",{className:"w-[10%]",children:(0,O.jsx)("h5",{className:"text-xs text-scale-900",children:"Primary"})}),(0,O.jsx)("div",{className:"".concat(S?"w-[10%]":"w-0")}),(0,O.jsx)("div",{className:"w-[5%]"}),!S&&(0,O.jsx)("div",{className:"w-[5%]"})]}),Z.length>0&&(0,O.jsx)(An.Z5,{onDragEnd:function(e){return D(e,"pks")},children:(0,O.jsx)(An.bK,{droppableId:"pk_columns_droppable",children:function(e){return(0,O.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-gray-400 px-3 py-2 ".concat(d?"":"-mx-3"),children:[Z.map((function(e,n){return(0,O.jsx)(An._l,{draggableId:e.id,index:n,children:function(n){return(0,O.jsx)("div",Gn(Gn({ref:n.innerRef},n.draggableProps),{},{children:(0,O.jsx)(Hn,{column:e,enumTypes:o,isNewRecord:d,hasImportContent:S,dragHandleProps:n.dragHandleProps,onEditRelation:function(){N(e)},onUpdateColumn:function(n){return _(e,n)},onRemoveColumn:function(){return R(e)}})}))}},e.id)})),e.placeholder]})}})}),(0,O.jsx)(An.Z5,{onDragEnd:function(e){return D(e,"others")},children:(0,O.jsx)(An.bK,{droppableId:"other_columns_droppable",children:function(e){return(0,O.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(d?"px-3 ":""),children:[E.map((function(e,n){return(0,O.jsx)(An._l,{draggableId:e.id,index:n,children:function(n){return(0,O.jsx)("div",Gn(Gn({ref:n.innerRef},n.draggableProps),{},{children:(0,O.jsx)(Hn,{column:e,enumTypes:o,isNewRecord:d,hasImportContent:S,dragHandleProps:n.dragHandleProps,onEditRelation:function(){N(e)},onUpdateColumn:function(n){return _(e,n)},onRemoveColumn:function(){return R(e)}})}))}},e.id)})),e.placeholder]})}})})]}),(0,O.jsxs)("div",{className:"flex items-center justify-between",children:[!S&&(0,O.jsx)(b.z,{type:"default",onClick:function(){return function(){var e=(0,un.QZ)(),n=a.concat(e);f(n)}()},children:"Add column"}),(0,O.jsx)(j(),{href:"https://supabase.com/docs/guides/database/tables#data-types",children:(0,O.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,O.jsx)(b.z,{type:"text",className:"text-scale-1000 hover:text-scale-1200",icon:(0,O.jsx)(an.Z,{size:12,strokeWidth:2}),children:"Learn more about data types"})})})]})]}),(0,O.jsx)(Qn,{column:g,visible:void 0!==g,closePanel:function(){return N(void 0)},saveChanges:function(e){var n,r;void 0!==g&&_(g,Gn({foreignKey:void 0!==e?{id:0,constraint_name:"",source_schema:null!==(n=null===t||void 0===t?void 0:t.schema)&&void 0!==n?n:"",source_table_name:null!==(r=null===t||void 0===t?void 0:t.name)&&void 0!==r?r:"",source_column_name:null===g||void 0===g?void 0:g.name,target_table_schema:e.table.schema,target_table_name:e.table.name,target_column_name:e.column.name,deletion_action:e.deletionAction}:void 0},void 0!==e&&{format:e.column.format,defaultValue:null}));N(void 0)}})]})},$n=[{id:(0,me.k$)(),name:"id",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,me.k$)(),name:"created_at",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}],et=t(67717);function nt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function tt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?nt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var rt=function(e){var n,t,r=e.table,a=e.selectedSchema,i=e.isDuplicating,s=e.visible,o=void 0!==s&&s,c=e.closePanel,d=void 0===c?function(){}:c,m=e.saveChanges,f=void 0===m?function(){}:m,h=e.updateEditorDirty,v=void 0===h?function(){}:h,x=(0,p.oR)(),y=x.ui,g=x.meta,N=(0,B.d2)().project,w=(0,u.isUndefined)(r),S=g.types.list((function(e){return!g.excludedSchemas.includes(e.schema)})),k=g.publications.list().find((function(e){return"supabase_realtime"===e.name})),P=null!==(n=null===k||void 0===k?void 0:k.tables)&&void 0!==n?n:[],C=!w&&P.some((function(e){return e.id===(null===r||void 0===r?void 0:r.id)})),E=(0,l.useState)({}),_=E[0],R=E[1],D=(0,l.useState)(),T=D[0],A=D[1],L=(0,l.useState)(!1),z=L[0],I=L[1],K=(0,l.useState)(),F=K[0],U=K[1],V=(0,l.useState)(!1),H=V[0],W=V[1],M=(0,l.useState)(!1),Y=M[0],q=M[1],G=(0,Ae.XJ)({projectRef:null===N||void 0===N?void 0:N.ref,connectionString:null===N||void 0===N?void 0:N.connectionString,schema:null===r||void 0===r?void 0:r.schema}).data||[];(0,l.useEffect)((function(){if(o)if(R({}),U(void 0),I(!1),w){A({id:0,name:"",comment:"",columns:$n,isRLSEnabled:!0,isRealtimeEnabled:!1})}else{var e=function(e,n){var t,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:r?"".concat(e.name,"_duplicate"):e.name,comment:r?"This is a duplicate of ".concat(e.name):null!==(t=null===e||void 0===e?void 0:e.comment)&&void 0!==t?t:"",columns:e.columns.map((function(t){return(0,un.uE)(t,e,n)})),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:a}}(r,G,i,C);A(e)}}),[o]),(0,l.useEffect)((function(){if(F&&!(0,u.isEmpty)(F)){var e=function(e){var n=e.headers,t=e.selectedHeaders,r=e.columnTypeMap;return n.filter((function(e){return t.includes(e)})).map((function(e){var n=r[e];return(0,un.QZ)({name:e,format:n})}))}(F);X({columns:e})}}),[F]);var X=function(e){var n=tt(tt({},T),e);A(n),v();for(var t=tt({},_),r=0,a=Object.keys(e);r<a.length;r++){delete t[a[r]]}R(t)},$=function(e){if(T){var n=function(e){var n={};return 0===e.name.length&&(n.name="Please assign a name for your table"),(0,u.some)(e.columns,(function(e){return 0===e.format.length}))&&(n.columns="Ensure that all your columns are assigned a type"),(0,u.some)(e.columns,(function(e){return 0===e.name.length}))&&(n.columns="Ensure that all your columns are named"),n}(T);if(n.columns&&y.setNotification({category:"error",message:n.columns,duration:4e3}),R(n),(0,u.isEmpty)(n)){var t=tt({name:T.name,schema:a,comment:T.comment},!w&&{rls_enabled:T.isRLSEnabled}),i=T.columns.map((function(e){return e.foreignKey?tt(tt({},e),{},{foreignKey:tt(tt({},e.foreignKey),{},{source_table_name:T.name})}):e})),s={tableId:null===r||void 0===r?void 0:r.id,importContent:F,isRLSEnabled:T.isRLSEnabled,isRealtimeEnabled:T.isRealtimeEnabled,isDuplicateRows:z};f(t,i,w,s,e)}else e()}};return T?(0,O.jsx)(J.ZP,{size:"large",visible:o,header:(0,O.jsx)(_n,{schema:a,table:r,isDuplicating:i}),className:"transition-all duration-100 ease-in ".concat(H?" mr-32":""),onCancel:d,onConfirm:function(){return function(e){return $(e)}},customFooter:(0,O.jsx)(ue.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:d,applyFunction:function(e){return $(e)}}),children:(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-10 py-6",children:[(0,O.jsx)(Ie.Z,{label:"Name",layout:"horizontal",type:"text",error:_.name,value:null===T||void 0===T?void 0:T.name,onChange:function(e){return X({name:e.target.value})}}),(0,O.jsx)(Ie.Z,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!==(t=null===T||void 0===T?void 0:T.comment)&&void 0!==t?t:"",onChange:function(e){return X({comment:e.target.value})}})]})}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-10 py-6",children:[(0,O.jsx)(sn.Z,{id:"enable-rls",label:(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,O.jsx)(dn.Z,{color:"gray",children:"Recommended"})]}),description:(0,O.jsx)(O.Fragment,{children:(0,O.jsx)("p",{children:"Restrict access to your table by enabling RLS and writing Postgres policies."})}),checked:T.isRLSEnabled,onChange:function(){T.isRLSEnabled?q(!0):X({isRLSEnabled:!T.isRLSEnabled})},size:"medium"}),T.isRLSEnabled?(0,O.jsxs)(Zn.Z,{withIcon:!0,variant:"info",className:"!px-4 !py-3 mt-3",title:"Policies are required to query data",children:[(0,O.jsxs)("p",{children:["You need to write an access policy before you can query data from this table. Without a policy, querying this table will result in an ",(0,O.jsx)("u",{children:"empty array"})," of results."]}),w&&(0,O.jsx)("p",{className:"mt-3",children:"You can create policies after you create this table."}),(0,O.jsx)("p",{className:"mt-4",children:(0,O.jsx)(j(),{href:"https://supabase.com/docs/guides/auth/row-level-security",children:(0,O.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,O.jsx)(b.z,{type:"default",icon:(0,O.jsx)(En.Z,{strokeWidth:1.5}),children:"RLS Documentation"})})})})]}):(0,O.jsxs)(Zn.Z,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 mt-3",title:"You are allowing anonymous access to your table",children:[(0,O.jsxs)("p",{children:[T.name?"The table ".concat(T.name):"Your table"," will be publicly writable and readable"]}),(0,O.jsx)("p",{className:"mt-4",children:(0,O.jsx)(j(),{href:"https://supabase.com/docs/guides/auth/row-level-security",children:(0,O.jsx)("a",{target:"_blank",rel:"noreferrer",children:(0,O.jsx)(b.z,{type:"default",icon:(0,O.jsx)(En.Z,{strokeWidth:1.5}),children:"RLS Documentation"})})})})]}),(0,O.jsx)(sn.Z,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:T.isRealtimeEnabled,onChange:function(){return X({isRealtimeEnabled:!T.isRealtimeEnabled})},size:"medium"})]})}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"space-y-10 py-6",children:[!i&&(0,O.jsx)(Xn,{table:{name:T.name,schema:a},columns:null===T||void 0===T?void 0:T.columns,enumTypes:S,isNewRecord:w,importContent:F,onColumnsUpdated:function(e){return X({columns:e})},onSelectImportData:function(){return W(!0)},onClearImportContent:function(){X({columns:$n}),U(void 0)}}),i&&(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(sn.Z,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:z,onChange:function(){return I(!z)},size:"medium"})}),(0,O.jsx)(Ct,{visible:H,headers:null===F||void 0===F?void 0:F.headers,rows:null===F||void 0===F?void 0:F.rows,saveContent:function(e){U(e),W(!1)},closePanel:function(){return W(!1)}}),(0,O.jsx)(Q.Z,{visible:Y,header:"Turn off Row Level Security",buttonLabel:"Confirm",size:"medium",onSelectCancel:function(){return q(!1)},onSelectConfirm:function(){X({isRLSEnabled:!T.isRLSEnabled}),q(!1)},children:(0,O.jsx)(Z.C.Content,{children:(0,O.jsx)(et.Z,{})})})]})})]})},"TableEditor"):null},at=t(13405),it=function(e){var n=e.input,t=e.onInputChange;return(0,O.jsxs)("div",{className:"space-y-10",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("p",{className:"mb-2 text-sm text-scale-1100",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,O.jsx)("code",{children:"-"}),") or underscores (",(0,O.jsx)("code",{children:"_"}),")."]}),(0,O.jsx)("p",{className:"text-sm text-scale-900",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,O.jsx)(Ie.Z.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:n,onChange:t})]})},st=t(37385),ot=t(39466),lt=function(e){var n=e.parseProgress,t=e.uploadedFile,r=e.onFileUpload,a=e.removeUploadedFile,i=(0,l.useState)(!1),s=i[0],o=i[1],c=(0,l.useRef)(null),d=function(e){"dragover"!==e.type||s?"dragleave"!==e.type&&"drop"!==e.type||o(!1):o(!0),e.stopPropagation(),e.preventDefault()};return(0,O.jsxs)("div",{className:"space-y-4",children:[(0,O.jsxs)("div",{children:[(0,O.jsxs)("p",{className:"mb-2 text-sm text-scale-1100",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,O.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,O.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),t?(0,O.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed dark:border-gray-700",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)(st.Z,{size:14,strokeWidth:1.5}),(0,O.jsx)("p",{className:"text-sm text-scale-1200",children:t.name})]}),100===n?(0,O.jsx)(b.z,{type:"outline",onClick:a,children:"Remove File"}):(0,O.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,O.jsx)(ge.Z,{className:"h-4 w-4 animate-spin"}),(0,O.jsx)(ot.Z,{value:n,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(n,"%")})]})]}):(0,O.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed dark:border-gray-700 ".concat(s?"bg-gray-500":""),onDragOver:d,onDragLeave:d,onDrop:function(e){d(e),r(e)},onClick:function(){var e;return null===(e=c.current)||void 0===e?void 0:e.click()},children:(0,O.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,O.jsx)("span",{className:"text-brand-900",children:"browse"})," your files"]})}),(0,O.jsx)("input",{ref:c,className:"hidden",type:"file",onChange:r})]})},ct=t(46381),dt=t.n(ct),ut=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],mt=["csv","tsv"],ft={headers:[],rows:[],rowCount:0,columnTypeMap:{}};function pt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function ht(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?pt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var vt=262144,xt=function(e){var n={},t=[];return new Promise((function(r){dt().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:function(e){var a=e.meta.fields||[],i=e.data,s=e.errors;a.forEach((function(t){var r=bt(t,e.data);(0,u.has)(n,t)?n[t]!==r&&(n[t]="text"):n[t]=r})),t=e.data.slice(0,20),r({headers:a,rows:i,previewRows:t,columnTypeMap:n,errors:s})}})}))},jt=function(e,n){var t=[],r=0,a=0,i=[],s={},o=[];return new Promise((function(l){dt().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:vt,chunk:function(l){if((t=l.meta.fields).forEach((function(e){var n=bt(e,l.data);(0,u.has)(s,e)?s[e]!==n&&(s[e]="text"):s[e]=n})),a+=l.data.length,i=l.data.slice(0,20),l.errors.length>0){var c=l.errors.map((function(e){return ht(ht({},e),{},{data:l.data[e.row]})}));o.push.apply(o,(0,ze.Z)(c))}var d=(r+=1)*vt/e.size;n(d>1?100:Number((100*d).toFixed(2)))},complete:function(){l({headers:t,rowCount:a,previewRows:i,columnTypeMap:s,errors:o})}})}))},bt=function(e,n){if(0===n.length)return"text";var t=n[0][e],r=n.map((function(n){return n[e]}));if(void 0===t||null===t)return"text";if(Number(t)){var a=n.map((function(n){return Number(n[e])}));return a.includes(NaN)?"text":a.map((function(e){return e%1})).every((function(e){return 0===e}))?"int8":"float8"}if((0,u.includes)(["true","false"],t.toString().toLowerCase())&&r.every((function(e){return null===e||void 0===e||(0,u.includes)(["true","false"],e.toString().toLowerCase())})))return"bool";if((0,me.dW)(t)&&r.every((function(e){return(0,me.dW)(t)})))return"jsonb";if(Date.parse(t)&&r.every((function(e){return Ye()(e,"YYYY-MM-DD hh:mm:ss").isValid()})))return"timestamptz";return"text"},yt=function(e){var n=null===e||void 0===e?void 0:e.name.split(".").pop().toLowerCase();return mt.includes(n)},gt=t(11872),Nt=t(51664),wt=function(e){var n=e.spreadsheetData,t=e.selectedHeaders,r=e.onToggleHeader,a=(0,l.useState)(!1),i=a[0],s=a[1];return(0,O.jsxs)(gt.ZP,{open:i,onOpenChange:s,className:"",children:[(0,O.jsx)(gt.ZP.Trigger,{asChild:!0,children:(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,O.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,O.jsx)(b.z,{type:"text",icon:(0,O.jsx)(Nt.Z,{size:18,strokeWidth:2,className:(0,ee.Z)("text-scale-1100",i&&"rotate-180")}),className:"px-1",onClick:function(){return s(!i)}})]})})}),(0,O.jsx)(gt.ZP.Content,{children:(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"py-2 space-y-3",children:[(0,O.jsxs)("div",{children:[(0,O.jsx)("p",{className:"text-sm text-scale-1100",children:"Select which columns to import"}),(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,O.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:n.headers.map((function(e){var n=t.includes(e);return(0,O.jsx)(b.z,{type:n?"primary":"default",className:(0,ee.Z)("transition",n?"opacity-100":"opacity-75"),onClick:function(){return r(e)},children:e},e)}))})]})})})]})},Ot=function(e){var n=e.headers,t=void 0===n?[]:n,r=e.rows,a=void 0===r?[]:r,i=e.height,s=t.slice(0,20),o=a.slice(0,20);return(0,O.jsx)(Ne.ZP,{columns:s.map((function(e){var n=o.map((function(n){var t,r;return null!==(t=null===(r=n[e])||void 0===r?void 0:r.toString())&&void 0!==t?t:""})),t=Math.max.apply(Math,(0,ze.Z)(n.map((function(e){return e.length}))));return{key:e,name:e,width:t>20?200:10*t,resizable:!0,headerRenderer:function(){return(0,O.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,O.jsx)("p",{className:"text-xs",children:e})})},formatter:function(n){var t=n.row,r=!t[e];return(0,O.jsx)("span",{className:(0,ee.Z)("text-sm flex items-center",r&&"text-scale-1000"),children:r?"NULL":t[e]})}}})),rows:o,className:"!border-l !border-r",style:{height:i||"".concat(34+34*(o.length||1),"px")}})},St=function(e){var n=e.selectedTable,t=e.spreadsheetData,r=e.errors,a=void 0===r?[]:r,i=e.selectedHeaders,s=e.incompatibleHeaders,o=(0,l.useState)(!1),c=o[0],d=o[1],u=(0,l.useState)([]),m=u[0],f=u[1],p=t.headers,h=t.rows,v=p.filter((function(e){return i.includes(e)})).slice(0,20),x=h.slice(0,20),j=void 0===n||0===s.length;(0,l.useEffect)((function(){d(!0)}),[t]);return(0,O.jsxs)(gt.ZP,{open:c,onOpenChange:d,className:"",children:[(0,O.jsx)(gt.ZP.Trigger,{asChild:!0,children:(0,O.jsx)(J.ZP.Content,{children:(0,O.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!j&&(0,O.jsx)(dn.Z,{color:"red",children:"Data incompatible"}),a.length>0&&(0,O.jsxs)(dn.Z,{color:"yellow",children:[a.length," issues found"]})]}),(0,O.jsx)(b.z,{type:"text",icon:(0,O.jsx)(Nt.Z,{size:18,strokeWidth:2,className:(0,ee.Z)("text-scale-1100",c&&"rotate-180")}),className:"px-1",onClick:function(){return d(!c)}})]})})}),(0,O.jsx)(gt.ZP.Content,{children:(0,O.jsxs)(J.ZP.Content,{children:[(0,O.jsxs)("div",{className:"mb-4",children:[(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:void 0===n?"Your table will have ".concat(t.rowCount.toLocaleString()," rows and the\n                        following ").concat(t.headers.length," columns."):"A total of ".concat(t.rowCount.toLocaleString(),' rows will be added to the table "').concat(n.name,'"')}),(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,O.jsx)("div",{className:"mb-4",children:v.length>0&&x.length>0?(0,O.jsx)(Ot,{height:350,headers:v,rows:x}):(0,O.jsxs)("div",{className:"flex items-center justify-center py-4 border border-scale-600 rounded-md space-x-2",children:[(0,O.jsx)(N.Z,{size:16,strokeWidth:1.5,className:"text-scale-1000"}),(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:0===v.length?"No headers have been selected":0===x.length?"Your CSV contains no data":""})]})}),(!j||a.length>0)&&(0,O.jsxs)("div",{className:"space-y-2 my-4",children:[(0,O.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,O.jsx)("p",{className:"text-sm",children:"Issues found in spreadsheet"}),j&&(0,O.jsx)("p",{className:"text-sm text-scale-1000",children:void 0!==n?"This CSV can still be imported into your table despite issues in the following rows.":"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,O.jsxs)("div",{className:"space-y-2",children:[!j&&(0,O.jsx)("div",{className:"space-y-2",children:(0,O.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,O.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center translate-y-[3px]",children:(0,O.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-scale-1000"})}),(0,O.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,O.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers:",(0,O.jsx)("br",{}),"The column",s.length>1?"s":""," ",s.map((function(e){return'"'.concat(e,'"')})).join(", ")," ",s.length>1?"are":"is"," not present in your table"]})]})}),a.map((function(e,n){var r,a,i="import-error-".concat(n),s=m.includes(i);return(0,O.jsxs)("div",{className:"space-y-2",children:[(0,O.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:function(){return function(e){m.includes(e)?f(m.filter((function(n){return n!==e}))):f(m.concat([e]))}(i)},children:[void 0!==e.data?(0,O.jsx)(te.Z,{size:14,className:"transform ".concat(s?"rotate-90":"")}):(0,O.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center",children:(0,O.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-scale-1000"})}),void 0!==e.data&&(0,O.jsxs)("p",{className:"text-sm w-14",children:["Row: ",e.row]}),(0,O.jsx)("p",{className:"text-sm",children:e.message}),(null===(r=e.data)||void 0===r?void 0:r.__parsed_extra)&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Ce.Z,{size:14}),(0,O.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),null===(a=e.data)||void 0===a?void 0:a.__parsed_extra.map((function(e,n){return(0,O.jsx)("code",{className:"text-xs",children:e},n)}))]})]}),void 0!==e.data&&s&&(0,O.jsx)(Ot,{headers:t.headers,rows:[e.data]})]},i)}))]})]})]})})]})};function kt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Pt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?kt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Ct=function(e){var n,t=e.visible,r=void 0!==t&&t,s=e.debounceDuration,c=void 0===s?250:s,d=e.headers,m=void 0===d?[]:d,f=e.rows,h=void 0===f?[]:f,v=e.selectedTable,x=e.saveContent,j=e.closePanel,b=e.updateEditorDirty,y=void 0===b?u.noop:b,g=(0,p.oR)().ui;(0,l.useEffect)((function(){r&&0===m.length&&Q()}),[r]);var N=(0,l.useState)("fileUpload"),w=N[0],S=N[1],k=(0,l.useState)(""),P=k[0],C=k[1],Z=(0,l.useState)(),E=Z[0],_=Z[1],R=(0,l.useState)(0),D=R[0],T=R[1],A=(0,l.useState)({headers:m,rows:h,rowCount:0,columnTypeMap:{}}),L=A[0],z=A[1],I=(0,l.useState)([]),K=I[0],F=I[1],U=(0,l.useState)([]),V=U[0],H=U[1],W=(null!==(n=null===v||void 0===v?void 0:v.columns)&&void 0!==n?n:[]).map((function(e){return e.name})),M=V.filter((function(e){return!W.includes(e)})),Y=void 0===v||0===M.length,q=function(e){T(e)},B=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r,a,s,l,c,d,m,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T(0),n.persist(),t=n.target.files||n.dataTransfer.files,r=(0,i.Z)(t,1),(a=r[0])&&(0,u.includes)(ut,null===a||void 0===a?void 0:a.type)&&yt(a)){e.next=7;break}g.setNotification({category:"info",message:"Sorry! We only accept CSV or TSV file types, please upload another file."}),e.next=21;break;case 7:return y(!0),_(a),e.next=11,jt(a,q);case 11:s=e.sent,l=s.headers,c=s.rowCount,d=s.columnTypeMap,m=s.errors,f=s.previewRows,m.length>0&&g.setNotification({error:m,category:"error",message:"Some issues have been detected on ".concat(m.length," rows. More details below the content preview."),duration:4e3}),F(m),H(l),z({headers:l,rows:f,rowCount:c,columnTypeMap:d});case 21:n.target.value="";case 22:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Q=function(){C(""),z(ft),_(void 0),F([]),y(!1)},G=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=14;break}return e.next=3,xt(n);case 3:t=e.sent,r=t.headers,a=t.rows,i=t.columnTypeMap,(s=t.errors).length>0&&g.setNotification({error:s,category:"error",message:"Some issues have been detected on ".concat(s.length," rows. More details below the content preview."),duration:4e3}),F(s),H(r),z({headers:r,rows:a,rowCount:a.length,columnTypeMap:i}),e.next=15;break;case 14:z(ft);case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),X=(0,l.useCallback)((0,u.debounce)(G,c),[]);return(0,O.jsxs)(J.ZP,{size:"large",visible:r,align:"right",header:void 0!==v?(0,O.jsxs)(O.Fragment,{children:["Add data to"," ",(0,O.jsxs)("code",{className:"text-sm",children:[v.schema,".",v.name]})]}):"Add content to new table",onCancel:function(){return j()},customFooter:(0,O.jsx)(ue.Z,{backButtonLabel:"Cancel",applyButtonLabel:void 0===v?"Save":"Import data",closePanel:j,applyFunction:function(e){"fileUpload"===w&&void 0===E?(g.setNotification({category:"error",message:"Please upload a file to import your data with"}),e()):0===V.length?(g.setNotification({category:"error",message:"Please select at least one header from your CSV"}),e()):Y?x(Pt(Pt({file:E},L),{},{selectedHeaders:V,resolve:e})):(g.setNotification({category:"error",message:"The data that you are trying to import is incompatible with your table structure"}),e())}}),children:[(0,O.jsx)(J.ZP.Content,{children:(0,O.jsx)("div",{className:"pt-6",children:(0,O.jsxs)(at.Z,{block:!0,type:"pills",onChange:S,children:[(0,O.jsx)(at.Z.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,O.jsx)(lt,{parseProgress:D,uploadedFile:E,onFileUpload:B,removeUploadedFile:Q})}),(0,O.jsx)(at.Z.Panel,{id:"pasteText",label:"Paste text",children:(0,O.jsx)(it,{input:P,onInputChange:function(e){C(e.target.value),X(e.target.value)}})})]})})}),L.headers.length>0&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"pt-4",children:(0,O.jsx)(J.ZP.Separator,{})}),(0,O.jsx)(wt,{spreadsheetData:L,selectedHeaders:V,onToggleHeader:function(e){var n=V.includes(e)?V.filter((function(n){return n!==e})):V.concat([e]);H(n)}}),(0,O.jsx)(J.ZP.Separator,{}),(0,O.jsx)(St,{selectedTable:v,spreadsheetData:L,errors:K,selectedHeaders:V,incompatibleHeaders:M}),(0,O.jsx)(J.ZP.Separator,{})]})]})},Zt=Te,Et=t(16188),_t=t(76309),Rt=t(51452);function Dt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Tt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Dt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var At=function(e){var n=e.schema,t=void 0===n?"public":n,r=e.name;return"\n    ".concat(Fn.kj,"\n\n    select pg_temp.pg_get_tabledef (\n      '").concat(t,"',\n      '").concat(r,"',\n      false,\n      'FKEYS_INTERNAL',\n      'INCLUDE_TRIGGERS'\n    ) as definition\n  ").trim()};function Lt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function zt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Lt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Lt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var It=function(e){var n=[e.schema,e.name].filter(Boolean).join(".");return"\n    select pg_get_viewdef('".concat(n,"', true) as definition\n  ").trim()},Kt=t(36782),Ft=t(88371),Ut=(0,c.Pi)((function(e){var n=e.id,t=(0,l.useRef)(null),r=(0,l.useRef)(null),i=(0,Ft.Fg)().isDarkMode,s=(0,h.Z)(n),c=(0,B.d2)().project,d=function(e){var n=e.projectRef,t=e.connectionString,r=e.schema,a=e.name,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,D.cp)({projectRef:n,connectionString:t,sql:It({schema:r,name:a}),queryKey:["view-definition",r,a]},zt({select:function(e){return e.result[0].definition.trim()}},i))}({schema:null===s||void 0===s?void 0:s.schema,name:null===s||void 0===s?void 0:s.name,projectRef:null===c||void 0===c?void 0:c.ref,connectionString:null===c||void 0===c?void 0:c.connectionString},{enabled:(null===s||void 0===s?void 0:s.type)===_t.l.VIEW||(null===s||void 0===s?void 0:s.type)===_t.l.MATERIALIZED_VIEW}),u=function(e){var n=e.projectRef,t=e.connectionString,r=e.schema,a=e.name,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,D.cp)({projectRef:n,connectionString:t,sql:At({schema:r,name:a}),queryKey:["table-definition",r,a]},Tt({select:function(e){return e.result[0].definition.trim()}},i))}({schema:null===s||void 0===s?void 0:s.schema,name:null===s||void 0===s?void 0:s.name,projectRef:null===c||void 0===c?void 0:c.ref,connectionString:null===c||void 0===c?void 0:c.connectionString},{enabled:(null===s||void 0===s?void 0:s.type)===_t.l.TABLE}),m=(null===s||void 0===s?void 0:s.type)===_t.l.VIEW||(null===s||void 0===s?void 0:s.type)===_t.l.MATERIALIZED_VIEW?d:u,f=m.data,p=m.isLoading,v=(null===s||void 0===s?void 0:s.type)===_t.l.VIEW?"create view ".concat(s.schema,".").concat(s.name," as\n"):(null===s||void 0===s?void 0:s.type)===_t.l.MATERIALIZED_VIEW?"create materialized view ".concat(s.schema,".").concat(s.name," as\n"):"",x=(0,l.useMemo)((function(){return f?(0,Kt.WU)(v+f,{language:"postgresql",keywordCase:"lower"}):void 0}),[f]),j=function(){var e=(0,a.Z)(o().mark((function e(n,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.current=n,r.current=a,n.changeViewZones((function(e){e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})})),e.next=5,(0,me.Vs)(500);case 5:null===n||void 0===n||n.focus();case 6:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return p?(0,O.jsxs)("div",{className:"py-4 space-y-2",children:[(0,O.jsx)(Rt.Z,{}),(0,O.jsx)(Rt.Z,{className:"w-3/4"}),(0,O.jsx)(Rt.Z,{className:"w-1/2"})]}):(0,O.jsx)("div",{className:"flex-grow overflow-y-auto border-t border-scale-400",children:(0,O.jsx)(G.ZP,{className:"monaco-editor",theme:i?"vs-dark":"vs",onMount:j,defaultLanguage:"pgsql",value:x,path:"",options:{domReadOnly:!0,readOnly:!0,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0}})})})),Vt=t(14164),Ht=t(53856),Wt=t(25297),Mt=t(2288);function Yt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function qt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Yt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Yt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Bt=function(e){var n,t,r,s=e.visible,c=e.onClose,d=(0,p.oR)().meta,u=(0,v.UO)(),m=u.ref,f=(u.page,u.id),h=(0,Et.at)({projectRef:m}),x=h.data,j=h.error,b=h.refetch,y=(0,Mt.qP)({projectRef:m}).data,g=(0,l.useState)("js"),N=g[0],w=g[1],S=(0,l.useState)({name:"hide",key:"SUPABASE_KEY"}),k=S[0],P=S[1],C=d.tables.list(),Z=qt(qt({},null===y||void 0===y?void 0:y.autoApiService),{},{endpoint:"".concat(null!==(n=null===y||void 0===y?void 0:y.autoApiService.protocol)&&void 0!==n?n:"https","://").concat(null!==(t=null===y||void 0===y?void 0:y.autoApiService.endpoint)&&void 0!==t?t:"-")}),E=null===y||void 0===y?void 0:y.autoApiService,_=null!==E&&void 0!==E&&E.service_api_keys.find((function(e){return"anon key"===e.name}))?E.defaultApiKey:void 0,R=function(e){var n=(e||{}).paths,t={};return Object.entries(n||[]).forEach((function(e){var n=(0,i.Z)(e,2),r=n[0],a=(n[1],r.slice(1)),s=a.replace("rpc/",""),o=s.replace(/_/g," "),l={id:s,displayName:o,camelCase:(0,me.TD)(s)};a.length&&(t[s]=l)})),t}(x);return(0,O.jsx)(J.ZP,{size:"xxlarge",visible:s,onCancel:function(){return c()},header:(0,O.jsxs)("span",{className:"flex items-center gap-2",children:[(0,O.jsx)(En.Z,{size:"tiny"}),"API"]}),customFooter:(0,O.jsx)(ue.Z,{backButtonLabel:"Close",hideApply:!0,formId:"wrapper-table-editor-form",closePanel:function(){return c()}}),children:(0,O.jsx)("div",{className:"Docs Docs--table-editor",children:(0,O.jsx)(J.ZP.Content,{children:j?(0,O.jsx)("div",{className:"p-6 mx-auto text-center sm:w-full md:w-3/4",children:(0,O.jsxs)("div",{className:"text-scale-1000",children:[(0,O.jsx)("p",{children:"Error connecting to API"}),(0,O.jsx)("p",{children:"".concat(j)})]})}):(0,O.jsx)(O.Fragment,{children:x?(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)("div",{className:"sticky top-0 z-10 bg-scale-100 dark:bg-scale-300",children:(0,O.jsx)(Ht.Z,{selectedLang:N,setSelectedLang:w,showApiKey:k,setShowApiKey:P,apiKey:_,autoApiService:Z})}),(null===x||void 0===x?void 0:x.definitions)&&(0,O.jsx)(Vt.MS,{autoApiService:Z,selectedLang:N,resourceId:null===(r=C.find((function(e){return e.id===Number(f)})))||void 0===r?void 0:r.name,resources:R,definitions:x.definitions,paths:x.paths,showApiKey:k.key,refreshDocs:(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}),(0,O.jsx)("div",{className:"mt-8",children:(0,O.jsx)(Wt.Z,{selectedLang:N})})]}):(0,O.jsx)("div",{className:"p-6 mx-auto text-center sm:w-full md:w-3/4",children:(0,O.jsx)("h3",{className:"text-lg",children:"Building docs ..."})})})})})},"WrapperTableEditor")};function Qt(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Jt(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Qt(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Qt(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Gt=(0,c.Pi)((function(e){var n,t,r,s,c,x=e.theme,j=void 0===x?"dark":x,b=e.selectedSchema,y=e.selectedTable,g=e.sidePanelKey,N=e.isDuplicating,w=e.selectedRowToEdit,k=e.selectedColumnToEdit,C=e.selectedTableToEdit,Z=e.selectedValueForJsonEdit,E=e.selectedForeignKeyToEdit,_=e.onAddRow,D=void 0===_?u.noop:_,A=e.onEditRow,L=void 0===A?u.noop:A,z=e.onAddColumn,I=void 0===z?u.noop:z,K=e.onEditColumn,F=void 0===K?u.noop:K,U=e.onDeleteColumn,V=void 0===U?u.noop:U,H=e.onExpandJSONEditor,W=void 0===H?u.noop:H,M=e.onEditForeignKeyColumnValue,Y=void 0===M?u.noop:M,Q=e.onClosePanel,J=void 0===Q?u.noop:Q,G=e.onImportData,X=void 0===G?u.noop:G,$=(0,p.oR)(),ee=$.meta,te=$.ui,re=$.vault,ae=(0,d.useRouter)(),ie=(0,v.UO)(),se=ie.ref,oe=ie.id,le=(0,l.useRef)(null),ce=(0,B.d2)().project,de=(0,p.P5)("vaultExtension"),ue=(0,l.useState)([]),me=ue[0],fe=ue[1],pe=(0,l.useState)(!1),he=pe[0],ve=pe[1],xe=(0,p.x3)(),je=(0,i.Z)(xe,2),be=je[0].view,ye=void 0===be?"data":be,ge=je[1],Ne=!(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"columns"),we=function(){var e=(0,a.Z)(o().mark((function e(n){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re.listEncryptedColumns(n.schema,n.name);case 2:t=e.sent,fe(t);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Oe=(0,f.NL)(),ke=q({onMutate:function(e){return(0,a.Z)(o().mark((function n(){var t,r,a,s,l,c,d;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.projectRef,r=e.table,a=e.configuration,s=e.payload,l=new Set(Object.keys(a.identifiers)),c=T.M.query(t,[r.schema,r.name,{table:{name:r.name,schema:r.schema}}]),n.next=5,Oe.cancelQueries(c);case 5:return d=Oe.getQueriesData(c),Oe.setQueriesData(c,(function(e){var n;return{result:null!==(n=null===e||void 0===e?void 0:e.result.map((function(e){return Object.entries(e).filter((function(e){var n=(0,i.Z)(e,1)[0];return l.has(n)})).every((function(e){var n=(0,i.Z)(e,2),t=n[0];return n[1]===a.identifiers[t]}))?Jt(Jt({},e),s):e})))&&void 0!==n?n:[]}})),n.abrupt("return",{previousRowsQueries:d});case 8:case"end":return n.stop()}}),n)})))()},onError:function(e){function n(n,t,r){return e.apply(this,arguments)}return n.toString=function(){return e.toString()},n}((function(e,n,t){t.previousRowsQueries.forEach((function(e){var n=(0,i.Z)(e,2),t=n[0],r=n[1];r&&Oe.setQueriesData(t,r),Oe.invalidateQueries(t)})),Ye(e)}))}),Pe=ke.mutate,Ce=(0,Et.at)({projectRef:se}).refetch,Ze=function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=(0,Ae.XJ)({projectRef:null===ce||void 0===ce?void 0:ce.ref,connectionString:null===ce||void 0===ce?void 0:ce.connectionString,schema:null===y||void 0===y?void 0:y.schema}).data||[];(0,l.useEffect)((function(){void 0!==y&&void 0!==y.id&&de&&we(y)}),[null===y||void 0===y?void 0:y.id]);var _e=(0,h.Z)(null===y||void 0===y?void 0:y.id);if((0,u.isUndefined)(y))return(0,O.jsx)(P,{id:Number(oe)});var Re=null===y||void 0===y?void 0:y.id,De=(null===_e||void 0===_e?void 0:_e.type)===_t.l.VIEW||(null===_e||void 0===_e?void 0:_e.type)===_t.l.MATERIALIZED_VIEW,Te=(null===_e||void 0===_e?void 0:_e.type)===_t.l.TABLE,Le=(null===_e||void 0===_e?void 0:_e.type)===_t.l.FOREIGN_TABLE,ze=ee.excludedSchemas.includes(null!==(n=null===_e||void 0===_e?void 0:_e.schema)&&void 0!==n?n:""),Ie=(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables"),Ke=Te&&!ze,Fe=(null!==(t=null===y||void 0===y?void 0:y.relationships)&&void 0!==t?t:[]).map((function(e){var n,t=Ee.find((function(n){return n.id===e.id}));return Jt(Jt({},e),{},{deletion_action:null!==(n=null===t||void 0===t?void 0:t.deletion_action)&&void 0!==n?n:Fn.HO.NO_ACTION})})),Ue=De||Le?(0,R.parseSupaTable)({table:y,columns:null!==(c=y.columns)&&void 0!==c?c:[],primaryKeys:[],relationships:[]}):(0,R.parseSupaTable)({table:y,columns:null!==(r=y.columns)&&void 0!==r?r:[],primaryKeys:null!==(s=y.primary_keys)&&void 0!==s?s:[],relationships:Fe},me),Ve="".concat(y.schema,"_").concat(y.name),He=function(){var e=(0,a.Z)(o().mark((function e(n){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee.query(n);case 2:if(!(t=e.sent).error){e.next=7;break}return e.abrupt("return",{error:t.error});case 7:return e.abrupt("return",{data:t});case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),We=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ee.tables.list(),r=t.find((function(e){return e.id===Number(Re)})),(a=(0,u.find)(r.columns,{name:n}))?F(a):console.error("Unable to find column ".concat(n," in ").concat(null===r||void 0===r?void 0:r.name));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Me=function(){var e=(0,a.Z)(o().mark((function e(n){var t,r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ee.tables.list(),r=t.find((function(e){return e.id===Number(Re)})),a=(0,u.find)(r.columns,{name:n}),V(a);case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ye=function(e){var n,t;te.setNotification({category:"error",message:null!==(n=null!==(t=null===e||void 0===e?void 0:e.details)&&void 0!==t?t:null===e||void 0===e?void 0:e.message)&&void 0!==n?n:e})};return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(R.SupabaseGrid,{ref:le,theme:j,gridProps:{height:"100%"},storageRef:se,editable:!Ne&&Ie&&Ke,schema:y.schema,table:Ue,refreshDocs:Ze,headerActions:Te||De||Ke?(0,O.jsxs)(O.Fragment,{children:[Ke&&(0,O.jsx)(S,{table:y,apiPreviewPanelOpen:he,setApiPreviewPanelOpen:ve,refreshDocs:Ze}),(Te||De)&&(0,O.jsxs)(O.Fragment,{children:[Ke&&(0,O.jsx)("div",{className:"h-[20px] w-px border-r border-scale-600"}),(0,O.jsx)("div",{children:(0,O.jsx)(ne,{width:75,options:["definition","data"],activeOption:ye,borderOverride:"border-gray-500",onClickOption:function(e){ge("data"===e?{view:void 0}:{view:e})}})})]})]}):null,onAddColumn:I,onEditColumn:We,onDeleteColumn:Me,onAddRow:D,updateTableRow:function(e,n){if(ce){var t=y.columns.filter((function(e){var n;return(null!==(n=null===e||void 0===e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()})).map((function(e){return e.name})),r={};y.primary_keys.forEach((function(n){return r[n.name]=e[n.name]}));var a={identifiers:r};if(0===Object.keys(r).length)return te.setNotification({category:"error",message:Se.jg});Pe({projectRef:ce.ref,connectionString:ce.connectionString,table:Ue,configuration:a,payload:n,enumArrayColumns:t})}},onEditRow:L,onImportData:X,onError:Ye,onSqlQuery:He,onExpandJSONEditor:W,onEditForeignKeyColumnValue:Y,showCustomChildren:(De||Te)&&"definition"===ye,customHeader:(De||Te)&&"definition"===ye?(0,O.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,O.jsxs)("p",{children:["SQL Definition of ",(0,O.jsx)("code",{className:"text-sm",children:y.name})," "]}),(0,O.jsx)("p",{className:"text-scale-1000 text-sm",children:"(Read only)"})]}):null,children:(De||Te)&&(0,O.jsx)(Ut,{id:null===y||void 0===y?void 0:y.id})},Ve),!(0,u.isUndefined)(b)&&(0,O.jsx)(Zt,{selectedSchema:b,isDuplicating:N,selectedTable:y,selectedRowToEdit:w,selectedColumnToEdit:k,selectedTableToEdit:C,selectedValueForJsonEdit:Z,selectedForeignKeyToEdit:E,sidePanelKey:g,onRowCreated:function(e){le.current&&le.current.rowAdded(e)},onRowUpdated:function(e,n){le.current&&le.current.rowEdited(e,n)},onColumnSaved:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&we(y)},onTableCreated:function(e){ae.push("/project/".concat(se,"/editor/").concat(e.id))},closePanel:J}),(0,O.jsx)(Bt,{visible:he,onClose:function(){return ve(!1)}})]})})),Xt=t(58069),$t=t(89744),er=(0,c.Pi)((function(e){var n,t,r=e.selectedSchema,a=e.onAddTable,s=!(0,p.oR)().meta.excludedSchemas.includes(r)&&(0,p.FH)(m.KA.TENANT_SQL_ADMIN_WRITE,"tables"),o=(0,p._)("table-editor-sort","alphabetical"),l=(0,i.Z)(o,1)[0],c=(0,B.d2)().project,d=(0,Xt.H)({projectRef:null===c||void 0===c?void 0:c.ref,connectionString:null===c||void 0===c?void 0:c.connectionString,schema:r,sort:l},{keepPreviousData:!0}).data,u=null!==(n=null===d||void 0===d||null===(t=d.pages)||void 0===t?void 0:t[0].data.count)&&void 0!==n?n:0;return(0,O.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:0===u?(0,O.jsx)($t.Z,{title:"Table Editor",ctaButtonLabel:s?"Create a new table":void 0,onClickCta:s?a:void 0,children:(0,O.jsx)("p",{className:"text-sm text-scale-1100",children:"There are no tables available in this schema."})}):(0,O.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,O.jsx)($t.Z,{title:"Table Editor",ctaButtonLabel:s?"Create a new table":void 0,onClickCta:s?a:void 0,children:(0,O.jsxs)("p",{className:"text-sm text-scale-1100",children:["Select a table from the navigation panel on the left to view its data",s&&", or create a new one."]})})})})})),nr=Gt}}]);
//# sourceMappingURL=2062-69adb07992a26e74.js.map